angular.module("saveTime.env",[]).constant("ENV",{backendUrl:"http://api.apps.savetime.io:80",enableLogging:!0,Parse:{applicationId:"HD4dUI7ig38vWabKXbWIdHtmVrwSq1gsLKeJLPlB",javaScriptKey:"cTR37byIQJjzGI9MdGAmd2EYySTAm7XgbkCUxG7d",RestApiKey:"MscBh4ni01inPGtrG3kZJtSWHZ3fGonD4s5CpL10",serverURL:"http://localhost:1337/parse",Facebook:{appId:"1402508343399917",channelUrl:"http://savetime.io/channel.html"}},Google:{Maps:{key:"AIzaSyCwfGuJkFDA19hiRMz6GrZY8eOhM7P-5Fs"}}}),angular.module("saveTime",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngStorage","restangular","ui.router","ngMaterial","ngMessages","formly","formlyBootstrap","ng.deviceDetector","mgcrea.ngStrap","angular-loading-bar","helpers","ui-notification","filereader","uiGmapgoogle-maps","ngGeolocation","ngTable","ngResize","angular-bootstrap-select","angularSpinner","duScroll","ng-fastclick","saveTime.env","log.ex.uo","angularMoment","FBAngular","webcam","ngSails","parse-angular","parse-angular.enhance","textAngular","picardy.fontawesome","pascalprecht.translate","ParseServices","FacebookPatch"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$mdThemingProvider",function(e,t,n,a){e.state("errorPage",{url:"/error/:code",templateUrl:"app/components/errorPage/errorPage.html",controller:"ErrorPageCtrl"}).state("landing",{url:"/",templateUrl:"app/landing/landing.html",controller:"LandingCtrl"}).state("login",{url:"/login",templateUrl:"app/login/login.html",controller:"LoginCtrl"}).state("dashboard",{url:"/dashboard",templateUrl:"app/dashboard/dashboard.html",controller:"DashboardCtrl"}).state("dashboardByHostname",{url:"/dashboard/:lineHostname",templateUrl:"app/dashboard/dashboard.html",controller:"DashboardCtrl"}).state("myLines",{url:"/my",templateUrl:"app/myLines/myLines.html",controller:"MyLinesCtrl"}).state("resolveLines",{url:"/resolve",templateUrl:"app/resolveLines/resolveLines.html",controller:"ResolveLinesCtrl"}).state("resolveLinesPanel",{url:"/resolve/:lineId",templateUrl:"app/resolveLines/resolveLinesPanel.html",controller:"ResolveLinesPanelCtrl"}).state("newLine",{url:"/new",templateUrl:"app/newLine/newLine.html",controller:"NewLineCtrl as vm"}),t.otherwise("/"),n.html5Mode({enabled:!0,requireBase:!0}).hashPrefix("!"),a.definePalette("saveTimePaletteBlue",{50:"E3F2FD",100:"BBDEFB",200:"90CAF9",300:"64B5F6",400:"42A5F5",500:"0D47A1",600:"1E88E5",700:"1976D2",800:"1565C0",900:"0D47A1",A100:"E3F2FD",A200:"BBDEFB",A400:"64B5F6",A700:"0D47A1",contrastDefaultColor:"light",contrastDarkColors:["50","100","200","A100"],contrastLightColors:void 0}),a.definePalette("saveTimePaletteGreen",{50:"E8F5E9",100:"C8E6C9",200:"A5D6A7",300:"81C784",400:"66BB6A",500:"4CAF50",600:"43A047",700:"388E3C",800:"2E7D32",900:"1B5E20",A100:"B9F6CA",A200:"00C853",A400:"00E676",A700:"00C853",contrastDefaultColor:"light",contrastDarkColors:["50","100","200","500","900","A100"],contrastLightColors:void 0}),a.theme("default").primaryPalette("saveTimePaletteBlue").accentPalette("saveTimePaletteGreen").warnPalette("red").backgroundPalette("grey")}]).config(["uiGmapGoogleMapApiProvider","ENV",function(e,t){e.configure({key:t.Google.Maps.key,v:"3.17",libraries:"places"})}]).config(["$sailsProvider","ENV",function(e,t){e.url=t.backendUrl}]).config(["logExProvider","ENV",function(e,t){e.enableLogging(t.enableLogging)}]).config(["$translateProvider",function(e){e.translations("en",{DASHBOARD_TERMINAL_YOUR_NUMBER_IS:"Your number is",DASHBOARD_TERMINAL_INSERT_DISPLAY_NAME:"Insert a display name here!",DASHBOARD_TERMINAL_GET:"GET",DASHBOARD_TERMINAL_NUMBER:"NUMBER"}),e.translations("hr",{DASHBOARD_TERMINAL_YOUR_NUMBER_IS:"VaÅ¡ broj je",DASHBOARD_TERMINAL_INSERT_DISPLAY_NAME:"Unesite svoje ime i prezime!",DASHBOARD_TERMINAL_GET:"DOHVATI",DASHBOARD_TERMINAL_NUMBER:"BROJ"}),e.preferredLanguage("en")}]).run(["$rootScope","ParseSDK","deviceDetector",function(e,t,n){e.DEVICE=n}]),angular.module("saveTime").controller("ProfileCtrl",["$scope","$rootScope","$state","$mdDialog","$timeout","cfpLoadingBar","AuthenticateService",function(e,t,n,a,i,s,r){function o(t){t&&(u=t);var n=e.$new(!0);n.user=r.getCurrentUser(),a.show({controller:l,templateUrl:"app/components/navbar/profileDialog.tmpl.html",scope:n,parent:angular.element(document.body),targetEvent:u})}function l(e,t,n,a,i,s,r,l,u){e.DEVICE=i;var c={};e.browseProfilePicture=function(t){l.readAsDataURL(t[0],e).then(function(n){e.profilePicture={name:t[0].name,base64:n},c.profilePicture=e.profilePicture},function(e){n.error("Image error",e)})},e.resetProfilePicture=function(){delete e.profilePicture.file,e.profilePicture={}},e.hide=function(){a.hide()},e.cancel=function(){a.cancel()},e.answer=function(i){n.info(i),a.hide(i),"update"===i&&(r.start(),c.displayName=e.user.attributes.displayName,c.beAnonymousKeepPrivate=e.user.attributes.beAnonymousKeepPrivate,u.updateProfile(c,function(e,a){if(r.complete(),a){o(),n.error("Profile update error",a);var i="Profile is not updated, please try again.";a.message&&(i=a.message),100===a.code&&(i="Profile is not updated because profile picture file has errors, please choose another image."),s.error({title:"Error",message:i,delay:7e3})}else n.info(e),t.checkIsDisabledUpdateRequest(),s.success({title:"Success",message:"Profile is updated.",delay:5e3})}))}}e.EditProfile=o;var u;l.$inject=["$scope","$rootScope","$log","$mdDialog","deviceDetector","Notification","cfpLoadingBar","FileReader","UserService"]}]),angular.module("saveTime").controller("NavbarCtrl",["$scope","$rootScope","$state","$timeout","AuthenticateService",function(e,t,n,a,i){e.currentUser=i.getCurrentUser(),a(function(){e.showBackButton=!0},"logout"===t.paramFromState?2e3:0),e.GoToLanding=function(){n.go("landing")},e.GoToMyWaitingLines=function(){n.go("myLines")},e.GoToNewWaitingLine=function(){n.go("newLine")},e.GoToDashboard=function(){i.getCurrentUser()&&(i.checkAuthStatus(),n.go("dashboard"))},e.GoToResolveLines=function(){n.go("resolveLines")}}]),angular.module("saveTime").controller("LogoutCtrl",["$scope","$rootScope","$state","cfpLoadingBar","AuthenticateService",function(e,t,n,a,i){e.Logout=function(){for(var n in t)"DEVICE"!==n&&0!==n.indexOf("$")&&(console.log(n),delete t[n]);e.$parent.showBackButton=!1,t.paramFromState="logout",a.start(),i.logOut(),a.complete()}}]),angular.module("saveTime").controller("FooterCtrl",["$scope","ConfigConst",function(e,t){e.copyRightTitle=t.copyRightTitle,e.copyRightYear=t.copyRightYear}]),angular.module("saveTime").controller("ErrorPageCtrl",["$scope","$stateParams",function(e,t){e.error={code:t.code},"404"===e.error.code&&(e.error.description="Resource not found!")}]),angular.module("saveTime").controller("ResolveLinesPanelCtrl",["$scope","$rootScope","$state","$stateParams","$timeout","$mdDialog","$log","$localStorage","cfpLoadingBar","AuthenticateService","WaitingLineService","ResolveLinesService","Notification","$sails",function(e,t,n,a,i,s,r,o,l,u,c,d,g,m){function p(e){var t=function(e,t){return e.updatedAt>t.updatedAt?-1:e.updatedAt<t.updatedAt?1:0},n=function(e,t){return e.updatedAt<t.updatedAt?-1:e.updatedAt>t.updatedAt?1:0},a=[];if(e){var i=angular.copy(e);i.sort(t),i.forEach(function(e){"undefined"==typeof e._serverData.panelName||e._serverData.resolvingFinishedAt||a.push(e)}),i.sort(n),i.forEach(function(e){"undefined"!=typeof e._serverData.panelName||e._serverData.resolvingFinishedAt||a.push(e)})}return a}function v(){if(e.people){for(var t=0;t<e.people.length;t++)if(!e.people[t]._serverData.resolvingFinishedAt)return!1;return!0}}function b(){return e.isThereMyRequest=!1,e.myCurrentRequestInResolving=null,e.people&&e.people.forEach(function(t){t._serverData.resolver&&t._serverData.resolver.id===f.id&&!t._serverData.resolvingFinishedAt&&(e.myCurrentRequestInResolving=t,e.isThereMyRequest=!0)}),e.myCurrentRequestInResolving}function h(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){if(t.hide(n),"update"===n){for(var a=[],i=0;i<e.line.clients.length;i++){var s=/^[_a-z0-9-]+(\.[_a-z0-9-]+)*(\+[a-z0-9-]+)?@[a-z0-9-]+(\.[a-z0-9-]+)*$/i;s.test(e.line.clients[i])&&a.push(e.line.clients[i])}e.line.clients=a,l.start(),c.update(e.line,function(t,n){if(l.complete(),n){var a="Clients are not updated, please try again.";n.message&&(a=n.message),g.error({title:"Error",message:a,delay:7e3})}else g.success({title:"Success",message:"Clients are updated.",delay:5e3}),e.line=t})}},e.AddNewClient=function(t){t?e.line.clients.unshift(""):e.line.clients.push("")}}u.checkAuthStatus();var f=u.getCurrentUser();if(!f._serverData.isResolver&&!f._serverData.isWaitingLineOwner)return void n.go("dashboard");e.currentUser=f,r.info("Current User",e.currentUser),e.isFullscreen=!1,e.toggleFullScreen=function(){e.isFullscreen=!e.isFullscreen},e.isMainScreenFullscreen=!1,e.toggleMainScreenFullscreen=function(){e.isMainScreenFullscreen=!e.isMainScreenFullscreen},e.setActiveLineStatus=function(t){t!==e.line._serverData.active&&(e.line.set("active",t),l.start(),c.update(e.line,function(t,n){if(l.complete(),n){var a=e.line._serverData.active?"Line is not activated, please try again.":"Line is not deactivated, please try again.";n.message&&(a=n.message),g.error({title:"Error",message:a,delay:7e3})}else g.success({title:"Success",message:e.line._serverData.active?"Line is activated.":"Line is deactivated.",delay:5e3})}))},e.resetCounter=function(){0!==e.line._serverData.counter&&(e.line.set("counter",0),l.start(),c.update(e.line,function(e,t){if(l.complete(),t){var n="Counter is not reset, please try again.";t.message&&(n=t.message),g.error({title:"Error",message:n,delay:7e3})}else g.success({title:"Success",message:"Counter is reset.",delay:5e3})}))},ion.sound({sounds:[{name:"bell_ring"}],path:"assets/sounds/",preload:!0,volume:1}),e.$on("$destroy",function(){m["delete"]("/notify/unsubscribe",{roomName:"waitingline"+a.lineId}).then(function(e){r.info("Unubscribe OK",e)},function(e){r.error("Unubscribe NOT OK",e)}),m.removeAllListeners(),E&&i.cancel(E)});var y=!1;m.on("connect",function(){m.post("/notify/subscribe",{roomName:"waitingline"+a.lineId}).then(function(e){r.info("Subscribe OK",e),y=!0},function(e){r.error("Subscribe NOT OK",e)})}),i(function(){y||m.post("/notify/subscribe",{roomName:"waitingline"+a.lineId}).then(function(e){r.info("Subscribe OK when connected",e),y=!0},function(e){r.error("Subscribe NOT OK when connected",e)})},2e3);var E=null;m.on("notify",function(t){r.info("Notify",t),c.peopleWhoWaitInLineDetailed(e.line,function(n,s){if(s)r.error("Error async notify - find line requests: ",s);else{E&&"resolvingStarted"===t&&i.cancel(E),c.findOneById(a.lineId,function(t,n){n||(e.line=t)}),r.info("Fresh People",n),e.people=n,v()&&(e.showFinished=!0),b();for(var o=p(n),l=0;l<o.length;l++)for(var u=0;u<e.screenPeople.length;u++)if(o[l].id===e.screenPeople[u].id){o[l]._serverData.panelName!==e.screenPeople[u]._serverData.panelName&&(r.info("Change screen assign panel"),e.screenPeople=o);break}if(("resolvingStarted"===t||"standInLine"===t)&&(r.info("Default change newPeople"),e.screenPeople=angular.copy(o)),"resolvingStarted"===t)for(var l=0;l<e.screenPeople.length;l++)if(!e.screenPeople[l]._serverData.resolvingFinishedAt){e.screenPeople[l].thisChanged=!0,E=i(function(){e.screenPeople[l]&&(e.screenPeople[l].thisChanged=!1)},1e4),e.isMainScreenFullscreen&&i(function(){e.line._serverData.soundEnabled&&(r.info("Play sound"),ion.sound.play("bell_ring"))},0);break}}})}),e.panelName="1";var w=o.panelName;w&&(e.panelName=w),e.$watch("panelName",function(){o.panelName=e.panelName}),e.showFinished=!1;var C=o.showFinished;"boolean"==typeof C&&(e.showFinished=C),e.$watch("showFinished",function(){o.showFinished=e.showFinished}),e.displayNumber=5;var D=o.displayNumber;D&&(e.displayNumber=D),e.$watch("displayNumber",function(){console.log(e.displayNumber),o.displayNumber=e.displayNumber}),e.displayNumbers=[3,4,5,6,7,8,9],e.resolver=u.getCurrentUser(),l.start(),c.findOneById(a.lineId,function(t,a){a?(l.complete(),r.error("Error - findOne line: ",a),n.go("errorPage",{code:400})):t?(r.info("Waiting line",t),r.info(t._serverData.ACL.permissionsById[e.currentUser.id]),r.info("Has permissions",!!t._serverData.ACL.permissionsById[e.currentUser.id]),c.peopleWhoWaitInLineDetailed(t,function(a,i){i?(l.complete(),r.error("Error - find line requests: ",i),n.go("errorPage",{code:400})):(r.info("People",a),l.complete(),e.line=t,e.people=a,v()&&(e.showFinished=!0),b(),e.screenPeople=p(a))})):n.go("errorPage",{code:404})}),e.NextRequest=function(t){if(!e.isDisabledNextButton||t){e.isDisabledNextButton=!0,i(function(){e.isDisabledNextButton=!1},5e3);var n=function(){for(var t=null,n=0;n<e.people.length;n++)if(!e.people[n]._serverData.resolver){t=e.people[n];break}t?e.StartResolving(t):s.show(s.alert().parent(angular.element(document.body)).title("No waiting visitors!").content("Congratulations, you can now get some rest!").ok("OK").targetEvent(null))};e.myCurrentRequestInResolving=b(),e.myCurrentRequestInResolving?e.FinishResolving(e.myCurrentRequestInResolving,n):n(),v()&&(e.showFinished=!0)}},e.StartResolving=function(t){r.info("Start resolving started"),b()?(r.info("Start resolving started finish after from backend without next request"),r.info("Next request try again FORCE until you get"),e.NextRequest(!0)):(r.info("Start resolving started finish before from backend"),l.start(),d.startResolving(t,e.panelName,function(n,a){r.info("Start resolving started finish from backend"),a?(l.complete(),r.error(a),g.error({title:"Error",message:"Resolving not started, please try again.",delay:7e3})):(r.info("Start resolving finished",n,f),n._serverData.resolver.id!==f.id?e.NextRequest(!0):(t=n,e.$apply(function(){e.myCurrentRequestInResolving=n,l.complete()})))}))},e.FinishResolving=function(e,t){b()&&(l.start(),d.finishResolving(e,function(n,a){l.complete(),a?(r.error(a),g.error({title:"Error",message:"Resolving not finished, please try again.",delay:7e3})):(r.info("Finish resolving finished",n),e=n,b(),t&&t())}))},e.ArchiveRequest=function(t){l.start(),d.archiveRequest(t,function(n,a){l.complete(),a?(r.error(a),e.people.splice(e.people.indexOf(t),1)):(r.info("Archive request finished",n),e.people.splice(e.people.indexOf(t),1))})},e.OpenClientsList=function(t){var n=e.$new(!0);e.line.clients=e.line.attributes.clients?e.line.attributes.clients:[],n.line=e.line,s.show({controller:h,templateUrl:"app/resolveLines/clientsDialog.tmpl.html",scope:n,parent:angular.element(document.body),targetEvent:t})},h.$inject=["$scope","$mdDialog"]}]),angular.module("saveTime").service("ResolveLinesService",["$log",function(){function e(e,t,n){e._serverData.resolver||(e.set("resolvingStartedAt",new Date),e.set("resolver",Parse.User.current()),e.set("panelName",t)),e.save(null,{success:n,error:n})}function t(e,t){e._serverData.resolvingFinishedAt||e.set("resolvingFinishedAt",new Date),e.save(null,{success:t,error:t})}function n(e,t){e.destroy({success:t,error:t})}Parse.Object.extend("WaitingLineRequest");return{startResolving:e,finishResolving:t,archiveRequest:n}}]),angular.module("saveTime").controller("ResolveLinesCtrl",["$scope","$rootScope","$state","$log","cfpLoadingBar","AuthenticateService","WaitingLineService","Notification",function(e,t,n,a,i,s,r){s.checkAuthStatus();var o=s.getCurrentUser();return o._serverData.isResolver||o._serverData.isWaitingLineOwner?(e.data={},i.start(),r.iAmResolvingLines(function(t,n){i.complete(),n?(a.error("Error - find my: ",n),e.data=[]):e.data=t}),void(e.OpenResolvePanel=function(e){n.go("resolveLinesPanel",{lineId:e.id})})):void n.go("dashboard")}]),angular.module("saveTime").controller("NewLineCtrl",["$scope","$rootScope","$log","$state","$http","$timeout","$geolocation","cfpLoadingBar","AuthenticateService","WaitingLineService","Notification","FileReader","uiGmapGoogleMapApi","stringHelperService",function(e,t,n,a,i,s,r,o,l,u,c,d,g,m){function p(){t.myPosition?(e.map={center:{},zoom:11},e.isMapLoaded=!0,e.map.center.latitude=t.myPosition.coords.latitude,e.map.center.longitude=t.myPosition.coords.longitude,b(e.map.center.latitude,e.map.center.longitude)):r.getCurrentPosition({timeout:6e4}).then(function(t){n.info(t),e.map={center:{},zoom:11},e.isMapLoaded=!0,e.map.center.latitude=t.coords.latitude,e.map.center.longitude=t.coords.longitude,b(e.map.center.latitude,e.map.center.longitude)},function(t){n.error(t),e.isMapLoaded=!0,v()})}function v(){var t=45.815010799999996,n=15.981919000000001;e.map={center:{latitude:t,longitude:n},zoom:3},b(t,n)}function b(t,n){e.marker={id:0,coords:{latitude:t,longitude:n},options:{draggable:!0},events:{dragend:function(t){t.getPosition().lat(),t.getPosition().lng();e.marker.options={draggable:!0,labelAnchor:"100 0",labelClass:"marker-labels"}}}}}function h(){f.line.icon={},delete e.iconFile}l.checkAuthStatus();var f=(l.getCurrentUser(),this);p(),e.currentSelectedAddress=null,e.getAddress=function(t){var n={address:t,sensor:!0};return i.get("http://maps.googleapis.com/maps/api/geocode/json",{params:n}).then(function(t){for(var n=0;n<t.data.results.length;n++)if(t.data.results[n].formatted_address===f.line.address){e.currentSelectedAddress=t.data.results[n];break}return t.data.results})},e.CurrentSelectedAddressToPin=function(t){function n(){e.currentSelectedAddress&&e.map&&(b(e.currentSelectedAddress.geometry.location.lat,e.currentSelectedAddress.geometry.location.lng),e.map.zoom=14,e.map.center.latitude=e.currentSelectedAddress.geometry.location.lat,e.map.center.longitude=e.currentSelectedAddress.geometry.location.lng)}t?s(n,500):n()},f.domains=["savetime.io","pleasewaitfor.me","pricekaj.me"],e.TransformSubdomain=function(){f.line.subdomain=m.transformFreeStyleStringToHostName(f.line.subdomain)},f.line={title:" ",address:" ",active:!1,adsEnabled:!1,subdomain:"",domain:f.domains[0],icon:{}},f["default"]=angular.copy(f.line),f.lineFields=[{key:"title",type:"input",templateOptions:{type:"text",required:!0,label:"1. Waiting line title",placeholder:"Enter title"}},{key:"active",type:"checkbox",templateOptions:{label:"Is available for public after create?"}},{key:"adsEnabled",type:"checkbox",templateOptions:{label:"Is available for showing ads? Showing ads at waiting line enable money earning."}}],e.trimForm=function(){f.line.title=f.line.title.trim(),f.line.address=f.line.address.trim()},e.SubmitForm=function(){e.trimForm(),f.onSubmit()},f.onSubmit=function(){!e.createInProgress&&e.marker&&(e.createInProgress=!0,o.start(),f.line.location={latitude:e.marker.coords.latitude,longitude:e.marker.coords.longitude},u.create(f.line,function(t,n){if(o.complete(),e.createInProgress=!1,n){var i="New line is not created, please try again.";n.message&&(i=n.message),100===n.code&&(i="New line is not created because icon file has errors, please choose another image."),c.error({title:"Error",message:i,delay:7e3})}else f.line=angular.copy(f["default"]),p(),c.success({title:"Success",message:"New line is created.",delay:5e3}),a.go("myLines")}))},e.browseIcon=function(t){d.readAsDataURL(t[0],e).then(function(e){f.line.icon={name:t[0].name,base64:e}},function(e){n.error(e)})},e.resetIcon=h}]),angular.module("saveTime").controller("LoginCtrl",["$scope","$rootScope","$state","$mdDialog","$log","$timeout","$interval","$geolocation","cfpLoadingBar","AuthenticateService","deviceDetector",function(e,t,n,a,i,s,r,o,l,u,c){function d(e){var t=v;return t.test(e)}function g(t){t&&(t=t.replace(b,"$1<br>")),e.ErrorMessage=t}function m(t){e.SuccessMessage=t}function p(e){e&&(t.paramFromState=e),n.go("dashboard")}u.checkAuthStatus(),u.isSignedIn()&&n.go("dashboard");var v=/^[_a-z0-9-]+(\.[_a-z0-9-]+)*(\+[a-z0-9-]+)?@[a-z0-9-]+(\.[a-z0-9-]+)*$/i,b=/([_a-z0-9-]+(\.[_a-z0-9-]+)*(\+[a-z0-9-]+)?@[a-z0-9-]+(\.[a-z0-9-]+)*)/gi;e.user={email:"",password:""},e.emailRegex=v,e.ErrorMessage=null,e.SuccessMessage=null,e.Authenticate=function(n,a){return g(null),m(null),""===e.user.email?g("Email is required!"):d(e.user.email)?e.user.password&&0!==e.user.password.length?"signup"===n&&e.user.password&&e.user.password.length<8?g("Password must have at least <br> 8 characters!"):(l.start(),"signup"===n?u.signUp(e.user.email,e.user.password,function(t,n){l.complete(),n&&n.message?e.$apply(function(){return a?void 0:g(n.message)}):p("signup")}):"login"===n?u.logIn(e.user.email,e.user.password,function(n,a){if(l.complete(),a&&(a.code||a.message)){var s=a.message;101===a.code&&(s="Email or password<br>are incorrect!",e.Authenticate("signup",!0)),console.log(a),10403===a.code&&(s="This account is suspended,<br>for more details<br>please contact us to<br>savetime@savetime.io"),e.$apply(function(){return g(s)})}else i.info("Login OK user is ",n),!t.myPosition&&c.isDesktop()?window.location="/dashboard":p("login")}):"reset"===n&&u.resetPassword(e.user.email,function(t){if(l.complete(),!t||!t.message)return m("Password reset is requested,<br> please check your mailbox.");var n=t.message;205===t.code&&(n="No user found with email<br>"+e.user.email),e.$apply(function(){return g(n)})}),void s(function(){l.complete()},1e4)):g("Password is required!"):g("Email is in incorrect format!")},c.isDesktop()&&(t.myPosition||(i.info("Detect my location at login page"),o.getCurrentPosition({timeout:6e3}).then(function(e){i.info("My position at login",e),t.myPosition=e},function(e){i.error("My position error at login",e),t.myPositionError=e})))}]),angular.module("saveTime").controller("MyLinesCtrl",["$scope","$rootScope","$log","$state","$mdDialog","cfpLoadingBar","stringHelperService","ngTableParams","AuthenticateService","WaitingLineService","Notification","FileReader",function(e,t,n,a,i,s,r,o,l,u,c,d){function g(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){if(t.hide(n),"update"===n){for(var a=[],i=0;i<e.line.resolvers.length;i++){var r=/^[_a-z0-9-]+(\.[_a-z0-9-]+)*(\+[a-z0-9-]+)?@[a-z0-9-]+(\.[a-z0-9-]+)*$/i;r.test(e.line.resolvers[i])&&a.push(e.line.resolvers[i])}e.line.resolvers=a,s.start(),u.update(e.line,function(t,n){if(s.complete(),n){var a="Resolvers are not updated, please try again.";n.message&&(a=n.message),c.error({title:"Error",message:a,delay:7e3})}else c.success({title:"Success",message:"Resolvers are updated.",delay:5e3}),e.line=t})}},e.AddNewResolver=function(){e.line.resolvers.push("")}}function m(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(n),"update"===n&&(s.start(),u.update(e.line,function(t,n){if(s.complete(),n){var a="Messages are not updated, please try again.";n.message&&(a=n.message),c.error({title:"Error",message:a,delay:7e3})}else c.success({title:"Success",message:"Messages are updated.",delay:5e3}),e.line=t}))}}var p=5;l.checkAuthStatus();l.getCurrentUser();e.GoToCreateNewLine=function(){a.go("newLine")},e.data=[],e.hasLines=!0,e.tableParams=new o({page:1,count:5},{total:e.data.length,getData:function(t,n){t.resolve(e.data.slice((n.page()-1)*n.count(),n.page()*n.count()))}}),e.LoadMoreLines=function(){s.start(),u.my(e.data.length,p,function(t,a){s.complete(),a?n.error("Error - find my",a):(e.data.length<=0&&t.length<=0?e.hasLines=!1:e.data=e.data.concat(t),e.hasMoreLines=t.length<p?!1:!0)})},e.LoadMoreLines(),e.SaveLine=function(e){s.start(),u.update(e,function(e,t){if(s.complete(),t){var n="Line is not updated, please try again.";t.message&&(n=t.message),c.error({title:"Error",message:n,delay:7e3})}else c.success({title:"Success",message:"Line is updated.",delay:5e3})})},e.browseIcon=function(t,a){console.log(t,a),d.readAsDataURL(t[0],e).then(function(e){a.icon={name:t[0].name,base64:e}},function(e){n.error(e)})},e.ResetCounter=function(e){e.resetCounter=!0,e._serverData.active===!1&&(s.start(),u.resetCounter(e,function(e,t){if(s.complete(),t){var n="Counter is not reset, please try again.";t.message&&(n=t.message),c.error({title:"Error",message:n,delay:7e3})}else c.success({title:"Success",message:"Counter is reset to zero.",delay:5e3})}))},e.TransformHostName=function(e){return e=r.transformFreeStyleStringToHostName(e)},e.ChooseResolvers=function(t,n){var a=e.$new(!0);n.resolvers=n.attributes.resolvers?n.attributes.resolvers:[],a.line=n,i.show({controller:g,templateUrl:"app/myLines/resolversDialog.tmpl.html",scope:a,parent:angular.element(document.body),targetEvent:t})},e.DefineMessages=function(t,n){var a=e.$new(!0);a.line=n,i.show({controller:m,templateUrl:"app/myLines/messagesDialog.tmpl.html",scope:a,parent:angular.element(document.body),targetEvent:t})},g.$inject=["$scope","$mdDialog"],m.$inject=["$scope","$mdDialog"]}]),angular.module("saveTime").controller("LandingCtrl",["$scope","$state","$log","cfpLoadingBar","WaitingListService",function(e,t,n,a,i){function s(e,t,n,a){var i=window.screenLeft?window.screenLeft:window.screenX,s=window.screenTop?window.screenTop:window.screenY,r=i+window.innerWidth/2-n/2,o=s+window.innerHeight/2-a/2;return window.open(e,t,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+n+", height="+a+", top="+o+", left="+r)}e.email=null,e.emailValidationLabel=!1,e.WaitingListSubmitted="NO",e.OpenApp=function(){n.info("Go to app from landing"),t.go("login")},e.KeepMeUpdated=function(){e.email?(a.start(),i.create(e.email).success(function(){e.WaitingListSubmitted="YES",a.complete()}).error(function(){e.WaitingListSubmitted="ERROR",a.complete()})):e.emailValidationLabel=!0},window.onbeforeunload=function(){r&&r.close(),o&&o.close()};var r=null;e.OpenPopUpFacebook=function(e){r=s(e,"popupwindow",600,480)};var o=null;e.OpenPopUpTwitter=function(e){o=s(e,"popupwindow",600,480)}}]),angular.module("helpers",[]),angular.module("helpers").directive("validateEmail",function(){var e=/^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/;return{require:"ngModel",restrict:"",link:function(t,n,a,i){i&&i.$validators.email&&(i.$validators.email=function(t){return i.$isEmpty(t)||e.test(t)})}}}),angular.module("saveTime").service("stringHelperService",function(){function e(e){for(var t=[{base:"A",letters:/[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g},{base:"AA",letters:/[\uA732]/g},{base:"AE",letters:/[\u00C6\u01FC\u01E2]/g},{base:"AO",letters:/[\uA734]/g},{base:"AU",letters:/[\uA736]/g},{base:"AV",letters:/[\uA738\uA73A]/g},{base:"AY",letters:/[\uA73C]/g},{base:"B",letters:/[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},{base:"C",letters:/[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},{base:"D",letters:/[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g},{base:"DZ",letters:/[\u01F1\u01C4]/g},{base:"Dz",letters:/[\u01F2\u01C5]/g},{base:"E",letters:/[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g},{base:"F",letters:/[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},{base:"G",letters:/[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g},{base:"H",letters:/[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g},{base:"I",letters:/[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g},{base:"J",letters:/[\u004A\u24BF\uFF2A\u0134\u0248]/g},{base:"K",letters:/[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g},{base:"L",letters:/[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g},{base:"LJ",letters:/[\u01C7]/g},{base:"Lj",letters:/[\u01C8]/g},{base:"M",letters:/[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},{base:"N",letters:/[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g},{base:"NJ",letters:/[\u01CA]/g},{base:"Nj",letters:/[\u01CB]/g},{base:"O",letters:/[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g},{base:"OI",letters:/[\u01A2]/g},{base:"OO",letters:/[\uA74E]/g},{base:"OU",letters:/[\u0222]/g},{base:"P",letters:/[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},{base:"Q",letters:/[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},{base:"R",letters:/[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g},{base:"S",letters:/[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g},{base:"T",letters:/[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g},{base:"TZ",letters:/[\uA728]/g},{base:"U",letters:/[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g},{base:"V",letters:/[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},{base:"VY",letters:/[\uA760]/g},{base:"W",letters:/[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},{base:"X",letters:/[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},{base:"Y",letters:/[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g},{base:"Z",letters:/[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g},{base:"a",letters:/[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g},{base:"aa",letters:/[\uA733]/g},{base:"ae",letters:/[\u00E6\u01FD\u01E3]/g},{base:"ao",letters:/[\uA735]/g},{base:"au",letters:/[\uA737]/g},{base:"av",letters:/[\uA739\uA73B]/g},{base:"ay",letters:/[\uA73D]/g},{base:"b",letters:/[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},{base:"c",letters:/[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g},{base:"d",letters:/[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g},{base:"dz",letters:/[\u01F3\u01C6]/g},{base:"e",letters:/[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g},{base:"f",letters:/[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},{base:"g",letters:/[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g},{base:"h",letters:/[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g},{base:"hv",letters:/[\u0195]/g},{base:"i",letters:/[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g},{base:"j",letters:/[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},{base:"k",letters:/[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g},{base:"l",letters:/[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g},{base:"lj",letters:/[\u01C9]/g},{base:"m",letters:/[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},{base:"n",letters:/[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g},{base:"nj",letters:/[\u01CC]/g},{base:"o",letters:/[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g},{base:"oi",letters:/[\u01A3]/g},{base:"ou",letters:/[\u0223]/g},{base:"oo",letters:/[\uA74F]/g},{base:"p",letters:/[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},{base:"q",letters:/[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},{base:"r",letters:/[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g},{base:"s",letters:/[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g},{base:"t",letters:/[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g},{base:"tz",letters:/[\uA729]/g},{base:"u",letters:/[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g},{base:"v",letters:/[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},{base:"vy",letters:/[\uA761]/g},{base:"w",letters:/[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},{base:"x",letters:/[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},{base:"y",letters:/[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g},{base:"z",letters:/[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g}],n=0;n<t.length;n++)e=e.replace(t[n].letters,t[n].base);
return e}function t(t){return t=t.replace(/\s+/g,"."),t=t.replace(/\.\.+/g,"."),t=e(t),t=t.toLowerCase()}return{replaceDiacritics:e,transformFreeStyleStringToHostName:t}}),angular.module("helpers").directive("ngEscape",function(){return function(e,t,n){t.bind("keydown keypress",function(t){27===t.which&&(e.$apply(function(){e.$eval(n.ngEscape,{$event:t})}),t.preventDefault())})}}),angular.module("helpers").directive("ngEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.ngEnter,{$event:t})}),t.preventDefault())})}}),angular.module("helpers").directive("fileread",[function(){return{scope:{fileread:"="},link:function(e,t){t.bind("change",function(t){var n=new FileReader;n.onload=function(t){e.$apply(function(){e.fileread=t.target.result})},n.readAsDataURL(t.target.files[0])})}}}]),angular.module("helpers").directive("fileNgChange",[function(){return{restrict:"A",scope:{fileNgChange:"&"},link:function(e,t){t.bind("change",function(){e.fileNgChange({selectedFileList:t[0].files})})}}}]),angular.module("saveTime").service("easingFunctionsService",function(){var e={linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return.5>e?2*e*e:-1+(4-2*e)*e},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return.5>e?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return.5>e?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return.5>e?16*e*e*e*e*e:1+16*--e*e*e*e*e}};return e}),angular.module("ParseServices",["saveTime.env"]).factory("ParseSDK",["ENV",function(e){return Parse.initialize(e.Parse.applicationId,e.Parse.javaScriptKey),Parse.serverURL=e.Parse.serverURL,window.fbPromise.then(function(){Parse.FacebookUtils.init({appId:e.Parse.Facebook.appId,channelUrl:e.Parse.Facebook.channelUrl,cookie:!0,xfbml:!0,frictionlessRequests:!0})}),{}}]),angular.module("FacebookPatch",[]).factory("FacebookAngularPatch",["$q","$timeout",function(e,t){var n=function(){var n=[].splice.call(arguments,0),a=e.defer(),i=t;return window.fbPromise.then(function(){n.push(function(e){return _.isUndefined(e.error)?void i(function(){a.resolve(e)}):void i(function(){a.reject(e.error)})}),FB.api.apply(FB,n)}),a.promise};window.fbPromise.then(function(){FB.apiAngular=n})}]),angular.module("saveTime").service("WaitingListService",["$http","ConfigConst","ENV",function(e,t,n){function a(t){var a={email:t};return e.post(n.backendUrl+"/waitinglist",a)}return{create:a}}]),angular.module("saveTime").service("WaitingLineService",["$log","ExchangeVariableService",function(e,t){function n(e,t){var n=new h;if(!e.title)return t(null,{message:"Title is required!"});if(!e.address)return t(null,{message:"Address is required!"});if(!e.icon||!e.icon.name||!e.icon.base64)return t(null,{message:"Icon is required! Please choose it from the file dialog."});if(!e.location||!e.location.latitude||!e.location.longitude)return t(null,{message:"Marker is required! Please pick it on map."});if(!e.subdomain||!e.domain)return t(null,{message:"Subdomain and domain are required."});n.set("title",e.title),n.set("active",e.active),n.set("nonActiveMessage",e.nonActiveMessage),n.set("adsEnabled",e.adsEnabled),n.set("remoteEnabled",e.remoteEnabled),n.set("nonRemoteEnabledMessage",e.nonRemoteEnabledMessage),n.set("address",e.address),n.set("counter",0);var a=new Parse.File(e.icon.name,{base64:e.icon.base64});n.set("iconOriginal",a);var i=new Parse.GeoPoint(e.location);n.set("location",i),n.set("owner",Parse.User.current()),n.set("resolvers",[Parse.User.current().attributes.email]),n.set("clients",[Parse.User.current().attributes.email]),n.set("hostname",e.subdomain+"."+e.domain);var s=new Parse.ACL(Parse.User.current());s.setPublicReadAccess(!0),n.setACL(s),n.save(null,{success:function(e){t(e),u(e)},error:function(e,n){t(e,n)}})}function a(e,t){var n=new Parse.Query(h);n.equalTo("objectId",e),n.first({success:function(e){t(e)},error:function(e){t(null,e)}})}function i(t,n){var a=new Parse.Query(h);if(a.limit(t.limit?parseInt(t.limit):1e3),t.ownerEqualTo&&a.equalTo("owner",t.ownerEqualTo),t.suspended===!1&&a.equalTo("suspended",!1),t.notResolved&&a.equalTo("resolvingFinishedAt",null),t.active&&a.equalTo("active",!0),t.approved&&a.equalTo("approved",!0),t.searchItems&&(e.info(t.searchItems),a.containsAll("searchItems",t.searchItems)),t.resolver&&(e.info(t.resolver),a.containsAll("resolvers",[t.resolver])),t.withinKilometers){var i=new Parse.GeoPoint({latitude:t.withinKilometers.latitude,longitude:t.withinKilometers.longitude});a.withinKilometers("location",i,t.withinKilometers.distance)}var s=new Parse.Query(h);t.titleStartsWith&&s.startsWith("title",t.titleStartsWith),s.descending("createdAt"),s.limit(t.limit?parseInt(t.limit):1e3);var r=Parse.Query.or(a,s);r.limit(t.limit?parseInt(t.limit):1e3);var o=r;(t.withinKilometers||!t.titleStartsWith)&&(o=a),t.sort&&("DESC"===t.sort.createdAt&&o.descending("createdAt"),"DESC"===t.sort.updatedAt&&o.descending("updatedAt"),"ASC"===t.sort.title&&o.ascending("title")),t.skip&&(e.info("Skip "+parseInt(t.skip)+" records."),o.skip(parseInt(t.skip))),e.info("Final query is: ",o),o.find({success:function(e){n(e)},error:function(t){e.error("Find error: ",t),n(null,t)}})}function s(e,t,n,a,s){if(Parse.User.current()){var r={ownerEqualTo:Parse.User.current(),skip:e,limit:t,sort:{updatedAt:"DESC"}};s&&(r.sort=s),a&&(r.active=!0),i(r,n)}else n(null,{message:"User not authorized"})}function r(e){if(Parse.User.current()){var t={resolver:Parse.User.current().attributes.email,sort:{title:"ASC"},approved:!0};i(t,e)}else e(null,{message:"User not authorized"})}function o(t,n){if(t.attributes.resetCounterOnActiveFalse&&t._serverData.active===!0&&t.attributes.active===!1&&t.set("counter",0),t.clients)g(t,t.clients,function(t,n){n&&e.error(n)}),t.set("clients",t.clients);else if(t.resolvers)d(t,t.resolvers,function(t,n){n&&e.error(n)}),t.set("resolvers",t.resolvers);else if(t.attributes&&("string"==typeof t.attributes.title&&t.set("title",t.attributes.title),"string"==typeof t.attributes.address&&t.set("address",t.attributes.address),"boolean"==typeof t.attributes.active&&t.set("active",t.attributes.active),"string"==typeof t.attributes.nonActiveMessage&&t.set("nonActiveMessage",t.attributes.nonActiveMessage),"boolean"==typeof t.attributes.adsEnabled&&t.set("adsEnabled",t.attributes.adsEnabled),"boolean"==typeof t.attributes.remoteEnabled&&t.set("remoteEnabled",t.attributes.remoteEnabled),"string"==typeof t.attributes.nonRemoteEnabledMessage&&t.set("nonRemoteEnabledMessage",t.attributes.nonRemoteEnabledMessage),"string"==typeof t.attributes.hostname&&t.set("hostname",t.attributes.hostname)),t.icon){var a=new Parse.File(t.icon.name,{base64:t.icon.base64});t.set("iconOriginal",a)}t.save({success:function(e){n(e)},error:function(e,t){n(e,t)}})}function l(e,t){e.resetCounter&&e.set("counter",0),e.save({success:function(e){t(e)},error:function(e,n){t(e,n)}})}function u(e,t){var n=new Parse.ACL(Parse.User.current());n.setPublicReadAccess(!1);var a=new Parse.Role("resolver-"+e.id,n);a.getUsers().add(Parse.User.current()),t?a.save(null,{success:function(e){t(e)},error:function(e,n){t(e,n)}}):a.save()}function c(e,t){var n=new Parse.ACL(Parse.User.current());n.setPublicReadAccess(!1);var a=new Parse.Role("client-"+e.id,n);a.getUsers().add(Parse.User.current()),t?a.save(null,{success:function(e){t(e)},error:function(e,n){t(e,n)}}):a.save()}function d(t,n,a){if(!n||n.length<=0)return a(null,{message:"Emails should be defined!"});var i=new Parse.Query(Parse.User);i.containedIn("email",n),i.find({success:function(n){function i(t,n){t.getUsers().query().find().then(function(){t.getUsers().add(n),e.info(t),t.save(null,{success:a,error:a})})}if(e.info("Users",n),!n||n.length<=0)return a(null,{message:"Users with this emails not exists!"});var s=new Parse.Query(Parse.Role);s.equalTo("name","resolver-"+t.id),s.first({success:function(s){e.info("Role",s),s?i(s,n,a):u(t,function(t,s){return s?(e.error("Role - new",s),a(null,s)):void i(t,n,a)})},error:function(t){return e.error("Role - error",t),a(null,t)}})},error:function(t){return e.error(t),a(null,t)}})}function g(t,n,a){if(!n||n.length<=0)return a(null,{message:"Emails should be defined!"});var i=new Parse.Query(Parse.User);i.containedIn("email",n),i.find({success:function(n){function i(e,t){e.getUsers().query().find().then(function(){e.getUsers().add(t),e.save(null,{success:a,error:a})})}if(e.info("Users",n),!n||n.length<=0)return a(null,{message:"Users with this emails not exists!"});var s=new Parse.Query(Parse.Role);s.equalTo("name","client-"+t.id),s.first({success:function(s){e.info("Role",s),s?i(s,n,a):c(t,function(t,s){return s?(e.error("Role - new",s),a(null,s)):void i(t,n,a)})},error:function(t){return e.error("Role - error",t),a(null,t)}})},error:function(t){return e.error(t),a(null,t)}})}function m(n,a,i,s,r){var o;o=a?a:new f,o.set("requestedBy",Parse.User.current());var l=t.get("requestedByProfilePictureBase64");if(l){var u=new Parse.File("profilePictureFromWebCam",{base64:l});o.set("requestedByProfilePicture",u),t.set("requestedByProfilePictureBase64",null)}else o.set("requestedByProfilePicture",Parse.User.current().attributes.profilePictureThumbnail);var c=t.get("anonymousDisplayName");if(c?(o.set("requestedByDisplayName",c),t.set("anonymousDisplayName",null)):o.set("requestedByDisplayName",Parse.User.current().attributes.displayName),i&&i.latitude&&i.longitude){var d=new Parse.GeoPoint(i);o.set("location",d)}if(Parse.User.current().attributes.beAnonymousKeepPrivate)o.set("requestedByAnonymous",!0);else{var g=t.get("requestedByAnonymous");g?(o.set("requestedByAnonymous",!0),t.set("requestedByAnonymous",null)):o.set("requestedByAnonymous",!1)}s&&(e.info("requestedByComment",s),o.set("requestedByComment",s)),o.set("waitingLine",n),o.save(null,{success:r,error:r})}function p(e,t){e.set("comeThereAt",new Date),e.save(null,{success:t,error:t})}function v(e,t){var n=new Parse.Query(f);n.equalTo("requestedBy",Parse.User.current()),n.equalTo("waitingLine",e),n.notEqualTo("resolvingStartedAt",null),n.equalTo("resolvingFinishedAt",null);var a=new Parse.Query(f);a.equalTo("waitingLine",e),a.equalTo("resolvingStartedAt",null),a.equalTo("resolvingFinishedAt",null);var i=Parse.Query.or(n,a);i.ascending("createdAt"),i.limit(1e3),i.find().then(function(e){t(e)},function(e){t(null,e)})}function b(e,t){var n=new Parse.Query(f);n.ascending("createdAt"),n.equalTo("waitingLine",e),n.limit(1e3),n.include("resolver"),n.find().then(function(e){t(e)},function(e){t(null,e)})}var h=Parse.Object.extend("WaitingLine"),f=Parse.Object.extend("WaitingLineRequest");return{create:n,find:i,findOneById:a,my:s,standInLine:m,comeThere:p,iAmResolvingLines:r,peopleWhoWaitInLinePublic:v,peopleWhoWaitInLineDetailed:b,update:o,resetCounter:l}}]),angular.module("saveTime").service("UserService",["$log",function(){function e(e,t){var n=Parse.User.current();if(!e)return t(null,{message:"User data is not defined!"});if(e.profilePicture){var a=new Parse.File(e.profilePicture.name,{base64:e.profilePicture.base64});n.set("profilePicture",a)}e.displayName&&n.set("displayName",e.displayName),e.beAnonymousKeepPrivate?n.set("beAnonymousKeepPrivate",!0):n.set("beAnonymousKeepPrivate",!1),n.save(null,{success:t,error:t})}return{updateProfile:e}}]),angular.module("saveTime").service("UploadFileService",["$http","ENV",function(e,t){function n(n,a){e.post("https://api.parse.com/1/files/"+n.name,n,{withCredentials:!1,headers:{"X-Parse-Application-Id":t.Parse.applicationId,"X-Parse-REST-API-Key":t.Parse.RestApiKey,"Content-Type":n.type},transformRequest:angular.identity}).then(function(e){a(e)})}return{single:n}}]),angular.module("saveTime").service("ExchangeVariableService",["$log",function(){function e(e,t){n[e]=t}function t(e){return n[e]}var n={};return{set:e,get:t}}]),angular.module("saveTime").service("AuthenticateService",["$rootScope","$state","$log",function(e,t,n){function a(e,t,n){var a=new Parse.User;a.set("username",e),a.set("password",t),a.set("email",e),a.set("displayName",e.split("@")[0]),a.signUp(null,{success:function(e){return n(e)},error:function(e,t){return n(e,t)}})}function i(e,t,n){Parse.User.logIn(e,t,{success:function(e){return e.attributes.suspended?(Parse.User.logOut(),n(null,{code:10403})):n(e)},error:function(e,t){return n(e,t)}})}function s(e,t){Parse.User.requestPasswordReset(e,{success:function(){return t()},error:function(e){return t(e)}})}function r(){return Parse.User.current()}function o(){var e=r();return e?!0:!1}function l(){Parse.User.logOut(),t.go("login"),e.IsSignedIn=!1}function u(a){o()?(e.IsSignedIn=!0,Parse.User.current().fetch().then(function(e){n.info("User Sessions is OK",e),a&&a(!0)},function(t){n.error("User Sessions is NOT OK",t),209===t.code&&(Parse.User.logOut(),e.IsSignedIn=!1,a&&a(!1))})):(e.IsSignedIn=!1,"login"!==t.current.name&&t.go("login"))}return{signUp:a,logIn:i,resetPassword:s,getCurrentUser:r,checkAuthStatus:u,logOut:l,isSignedIn:o}}]),angular.module("saveTime").controller("WaitingLineActionCtrl",["$scope","$rootScope","$state","$stateParams","$log","$timeout","$window","$mdDialog","cfpLoadingBar","Notification","WaitingLineService","ResolveLinesService",function(e,t,n,a,i,s,r,o,l,u,c,d){e.disableNextRequest=!1,e.CancelMyRequest=function(n){var a=o.confirm().parent(angular.element(document.body)).title("Are you sure?").content("Request cancel is irreversible!").ok("YES").cancel("NO").targetEvent(n);o.show(a).then(function(){i.info("Confirm YES",a);var n=e.getMyWaitingRequestFromCurrentStack();l.start(),d.archiveRequest(n,function(n,a){if(l.complete(),a){i.error("Error Cancel WaitingLineRequest",a);var s="Please try again.";u.error({title:"Error",message:s,delay:7e3})}else i.info("Cancel WaitingLineRequest",n),t.CurrentSelectedWaitingLine&&(t.CurrentSelectedWaitingLine.waitingLineRequestComment=""),e.RefreshWaitingLineStack(),u.success({title:"Success",message:"Your request is successfully canceled.",delay:5e3})})},function(){i.info("Confirm NO",a)})},e.StandInLine=function(n,a){if(!Parse.User.current())return void r.location.reload();if(!n){if(e.disableNextRequest)return;e.disableNextRequest=!0,s(function(){e.disableNextRequest=!1},1e4)}var o;o=a?null:e.getMyWaitingRequestFromCurrentStack();var d;t.myPosition&&t.myPosition.coords&&(d={latitude:t.myPosition.coords.latitude,longitude:t.myPosition.coords.longitude});var g=t.CurrentSelectedWaitingLine;n||l.start(),c.standInLine(g,o,d,t.CurrentSelectedWaitingLine.waitingLineRequestComment,function(t,a){if(!n)if(l.complete(),a){i.error("Error WaitingLineRequest standInLine",a);var o="Waiting line rejected your request, please try again.";if(a.message&&(o=a.message,"WAITING_LINE_IS_UNACTIVE"===o||"WAITING_LINE_IS_REMOTE_DISABLED"===o||"WAITING_LINE_IS_SUSPENDED"===o))return void r.location.reload();142===a.code&&("VALIDATION_FAILED_WAITING_LINE_REQUEST_DUPLICATE_TRY"===a.message?(o="You already have waiting line request in this line, it is not allowed to stand twice.",s(function(){r.location.reload()},500)):(i.error("StandInLine try again bacause of ",a),e.StandInLine(!0,!0))),u.error({title:"Error",message:o,delay:7e3})}else i.info("WaitingLineRequest",t),e.RefreshWaitingLineStack(!0,!0),u.success({title:"Success",message:"Your request is successfully submitted.",delay:5e3})})},t.UpdateCurrentWaitingLineRequest=e.StandInLine}]),angular.module("saveTime").controller("WaitingLineCtrl",["$scope","$rootScope","$document","$log","$timeout","$sails","easingFunctionsService","cfpLoadingBar",function(e,t,n,a,i,s){e.LoadMorePeople=function(){e.LoadMorePeopleToWaitingStack()},e.blockNextRequest=!1,e.RefreshWaitingLine=function(t,s){a.info("RefreshWaitingLine"),(!e.blockNextRequest||t)&&(e.blockNextRequest=!0,i(function(){e.blockNextRequest=!1},5e3),e.RefreshWaitingLineStack(t,s),t||i(function(){var e="waiting-line-container",t=angular.element(document.getElementById(e));n.scrollToElementAnimated(t,60,0,null)},2500))},s.on("notify",function(t){a.info("Notify",t),e.$parent.myWaitingRequestFromCurrentStack&&e.$parent.isDisabledUpdateRequest&&("resolvingStarted"===t||"resolvingFinished"===t)&&e.RefreshWaitingLine(!0)})}]),angular.module("saveTime").controller("GetNumberWebCamCtrl",["$scope","$window","ExchangeVariableService",function(e,t,n){var a=null,i=null;e.showDemos=!1,e.edgeDetection=!1,e.mono=!1,e.invert=!1,e.patOpts={x:0,y:0,w:25,h:25},e.channel={},e.webcamError=!1,e.onError=function(t){e.$apply(function(){e.webcamError=t})},e.onSuccess=function(){a=e.channel.video,e.$apply(function(){e.patOpts.w=a.width,e.patOpts.h=a.height})},e.onStream=function(){},e.makeSnapshot=function(){if(a){var e=document.querySelector("#snapshot");if(!e)return;var t=Math.min(a.width,a.height);e.width=t,e.height=t;var n=e.getContext("2d"),o=s((a.width-t)/2,(a.height-t)/2,t,t);n.putImageData(o,0,0),r(e.toDataURL("image/jpeg",.9)),i=o}};var s=function(e,t,n,i){var s=document.createElement("canvas");s.width=a.width,s.height=a.height;var r=s.getContext("2d");return r.drawImage(a,0,0,a.width,a.height),r.getImageData(e,t,n,i)},r=function(t){e.snapshotData=t,n.set("requestedByProfilePictureBase64",t),n.set("requestedByAnonymous",!0)};e.downloadSnapshot=function(e){t.location.href=e}}]),angular.module("saveTime").controller("FindLineCtrl",["$scope","$rootScope","$state","$stateParams","cfpLoadingBar","$timeout","$q","$log","$geolocation","WaitingLineService","ExchangeVariableService","$sails",function(e,t,n,a,i,s,r,o,l,u,c,d){function g(){e.RefreshWaitingLineStack(),t.DEVICE.isDesktop()?t.CurrentSelectedWaitingLinePrepared=!0:s(function(){t.CurrentSelectedWaitingLinePrepared=!0},50)}function m(n){e.$parent.tryToCancelSavedTimeRefreshInterval(),t.CurrentSelectedWaitingLine&&t.CurrentSelectedWaitingLine.id===n.id?(t.CurrentSelectedWaitingLine=null,t.CurrentSelectedWaitingLinePrepared=!1):(t.CurrentSelectedWaitingLine=n,t.CurrentSelectedWaitingLine.waitingLineRequestComment="",g())}function p(n,a,s,r){var l={};if(a&&(l.skip=a),l.limit=s?s:E,l.suspended=!1,l.approved=!0,t.myPosition&&(o.info("Search use location: ",t.myPosition),l.withinKilometers={distance:100,latitude:t.myPosition.coords.latitude,longitude:t.myPosition.coords.longitude}),n){o.info("Search by query: "+n);var c=function(e){return e.toLowerCase()};n=n.replace(",","");var d=n.split(/\b/);d=_.map(d,c);var g=["the","in","and","i","pa","te","ni","niti","a","ali","nego","no"],d=_.filter(d,function(e){return e.match(/^\w+$/)&&!_.contains(g,e)});l.searchItems=d,l.titleStartsWith=n}i.start(),u.find(l,function(n){o.info("Waiting lines by searchQuery",n),i.complete(),e.$parent.searchInProgress=!1,e.firstWaitingLineGetDone||(e.firstWaitingLineGetDone=!0,n.length<=0&&(e.zeroAvailableWaitingLines=!0));for(var a=0;a<n.length;a++){for(var s=!1,u=0;u<e.lines.length;u++)if(e.lines[u]&&e.lines[u].id===n[a].id){s=!0;break}s||e.lines.push(n[a])}t.searchResultIsEmpty=0!==e.lines.length?!1:!0,e.hasMoreLines=n.length<l.limit?!1:!0,r&&r(n)})}function v(){t.myPosition?(o.info("Just load my position is ",t.myPosition),c.get("dashboardByHostnameWaitingLineHostname")||p()):(o.info("Detect my location"),s(function(){i.set(0),i.start()},300),l.getCurrentPosition({timeout:6e4}).then(function(e){o.info("My position",e),t.myPosition=e,o.info("loadLines in getPosition 001"),p()},function(e){o.error("My position error",e),t.myPositionError=e,s(function(){i.complete()},1e3)}))}o.info("Dashboard by hostname is",a.lineHostname);var b=c.get("dashboardByHostnameWaitingLineHostname");if(b)return o.info("Go to hostname from ExchangeVariable Service",b),n.go("dashboardByHostname",{lineHostname:b}),void e.RefreshWaitingLineStack(!0);var h=null;e.searchQuery=null,e.searchPlaceholder="Search by name or address",t.DEVICE.isDesktop()&&(e.searchPlaceholder="Search waiting lines by name or address"),e.hasMoreLines=!0;var f=3,y=5,E=t.DEVICE.isDesktop()?y:f,w=3;t.CurrentSelectedWaitingLine=null,e.Search=function(){e.isWaitingLineLoadedByHostname&&(o.info("Go to dashboard $scope.isWaitingLineLoadedByHostname"),n.go("dashboard")),h!==e.searchQuery&&(t.CurrentSelectedWaitingLine&&(t.searchResultIsEmpty=!0),t.CurrentSelectedWaitingLine=null,t.CurrentSelectedWaitingLinePrepared=!1,h=e.searchQuery,e.lines=[],e.$parent.searchInProgress=!0,p(e.searchQuery))},e.SelectLine=m,e.lines=[],e.LoadMoreLines=function(){p(e.searchQuery,e.lines.length,w)},a.lineHostname?(o.info("Store hostname in ExchangeVariableService",a.lineHostname),c.set("dashboardByHostnameWaitingLineHostname",a.lineHostname),p(a.lineHostname,0,1,function(t){if(e.lines[0]||(e.lines=t),o.info("Current line is",e.lines[0]),e.lines[0]){m(e.lines[0]),e.isWaitingLineLoadedByHostname=!0,e.$parent.scrollToWaitingLine(e.lines[0]),e.$on("$destroy",function(){d["delete"]("/notify/unsubscribe",{roomName:"waitingline"+e.lines[0].id}).then(function(e){o.info("Unubscribe OK",e)},function(e){o.error("Unubscribe NOT OK",e)}),d.removeAllListeners()});var n=!1;d.on("connect",function(){d.post("/notify/subscribe",{roomName:"waitingline"+e.lines[0].id}).then(function(e){o.info("Subscribe OK",e),n=!0},function(e){o.error("Subscribe NOT OK",e)})}),s(function(){n||d.post("/notify/subscribe",{roomName:"waitingline"+e.lines[0].id}).then(function(e){o.info("Subscribe OK when connected",e),n=!0},function(e){o.error("Subscribe NOT OK when connected",e)})},2e3)}else o.info("Go to dashboard after !$scope.lines[0]")})):(o.info("Get position at classic dashboard"),v()),e.EnableLocation=v}]),angular.module("saveTime").controller("DashboardCtrl",["$scope","$rootScope","$state","$stateParams","$window","$timeout","$mdDialog","$interval","$log","$document","$translate","cfpLoadingBar","AuthenticateService","deviceDetector","easingFunctionsService","WaitingLineService","uiGmapGoogleMapApi","ExchangeVariableService",function(e,t,n,a,i,s,r,o,l,u,c,d,g,m,p,v,b,h){i.loading_screen&&i.loading_screen.finish(),g.checkAuthStatus(function(e){e?(l.info("Is authenticated, flush history"),h.set("dashboardByHostnameWaitingLineHostname",null)):l.error("Not authenticated")}),e.isMainScreenFullscreen=!1,e.toggleMainScreenFullscreen=function(){e.isMainScreenFullscreen=!e.isMainScreenFullscreen},e.NewVisitorWantToEnter=function(){e.standInLineGlobalMessage&&(f&&s.cancel(f),e.standInLineGlobalError=null,e.standInLineGlobalMessage=null,e.anonymous.displayName=null)};var f=null;e.anonymous={displayName:""},e.StandInLineGlobal=function(){e.standInLineGlobalError=null,e.standInLineGlobalMessage=null,e.standInLineGlobalInProgress=!0,f&&s.cancel(f);var n;t.myPosition&&t.myPosition.coords&&(n={latitude:t.myPosition.coords.latitude,longitude:t.myPosition.coords.longitude});var a=t.CurrentSelectedWaitingLine;if(e.anonymous.displayName){var r=e.anonymous.displayName;r=r.trim(),r=r.split(" ");for(var o=0;o<r.length;o++)r[o]=r[o].charAt(0).toUpperCase()+r[o].slice(1);e.anonymous.displayName=r.join(" "),h.set("anonymousDisplayName",e.anonymous.displayName)}v.standInLine(a,null,n,"-",function(t,n){if(e.standInLineGlobalInProgress=!1,n){if(l.error("Error WaitingLineRequest",n),"WAITING_LINE_IS_UNACTIVE"===n.message||"WAITING_LINE_IS_SUSPENDED"===n.message)return void i.location.reload();e.StandInLineGlobal()}else l.info("WaitingLineRequest",t),e.standInLineGlobalMessage=t._serverData.number,f=s(function(){e.standInLineGlobalMessage=null,e.anonymous.displayName=null},1e4)})},e.$on("$destroy",function(){e.tryToCancelSavedTimeRefreshInterval()}),l.info("Device",t.DEVICE),e.currentUser=g.getCurrentUser(),e.currentUser&&e.currentUser._serverData.language&&c.use(e.currentUser._serverData.language),e.setDimensions=function(e){l.info("Window size",e),e.width>991?t.searchInputWidth=e.width/3-123:(t.searchInputWidth=t.DEVICE.isDesktop()?e.width-133:e.width-113,t.DEVICE.isMobile()&&s(function(){var e="waiting-line-container",t=angular.element(document.getElementById(e));u.scrollToElementAnimated(t,60,0,null)},600))},e.setDimensions({width:i.innerWidth,height:i.innerHeight}),e.scrollToWaitingLine=function(e){var n="waiting-line-actions-container";t.DEVICE.isDesktop()&&(n="dashboard-container");var a=angular.element(document.getElementById(n));t.CurrentSelectedWaitingLine&&t.CurrentSelectedWaitingLine.id===e.id&&(t.DEVICE.isDesktop()?u.scrollToElementAnimated(a):s(function(){u.scrollToElementAnimated(a,60,1500,p.easeInQuart)},250))};var y=!1;e.InformUserComeThere=function(){if(!y&&t.CurrentSelectedWaitingLine&&!e.myWaitingRequestFromCurrentStack.comeThereAt){y=!0;var n="SaveTime detect from your location that you are "+e.myWaitingRequestFromCurrentStack.distance+" from "+t.CurrentSelectedWaitingLine._serverData.title,a=r.confirm().parent(angular.element(document.body)).title("Did you come to the location?").content(n).ok("YES").cancel("NO").targetEvent(null);s(function(){r.show(a).then(function(){l.info("Confirm",a),y=!1,e.UpdateComeThere(),t.CurrentSelectedWaitingLine.SavedComeThere=!0},function(){l.info("Confirm",a),y=!1})},2e3)}},e.UpdateComeThere=function(){e.updateComeThereInProgress=!0,v.comeThere(e.getMyWaitingRequestFromCurrentStack(),function(t,n){e.updateComeThereInProgress=!1,n?l.error("Error comeThereAt",n):(l.info("comeThereAt updated"),e.myWaitingRequestFromCurrentStack.comeThereAt=t.attributes.comeThereAt,e.tryToCancelSavedTimeRefreshInterval())})},e.tryToCancelSavedTimeRefreshInterval=function(){t.savedTimeRefreshInterval&&(o.cancel(t.savedTimeRefreshInterval),t.savedTimeRefreshInterval=!1),e.calculateParamsFromPositionInterval&&(o.cancel(e.calculateParamsFromPositionInterval),e.calculateParamsFromPositionInterval=!1)},e.tryToCancelSavedTimeRefreshInterval();var E=100,w=7,C=w;e.waitingPeopleIsPrepared=!1,e.RefreshWaitingLineStack=function(n,a){e.tryToCancelSavedTimeRefreshInterval();var i=t.CurrentSelectedWaitingLine;i._serverData.active&&(e.waitingPeopleLoadInProgress=!0,C=w,d.start(),e.myWaitingRequestFromCurrentStack=null,e.waitingPeopleIsPrepared=!1,l.info("Refresh waiting line stack",e.waitingPeople),e.waitingPeople=[],v.peopleWhoWaitInLinePublic(i,function(i,r){if(d.complete(),r)l.error("Error find WaitingLineRequests",r);else{l.info("Find WaitingLineRequests",i),e.waitingPeopleAll=i,n?e.LoadMorePeopleToWaitingStack(100,a):e.LoadMorePeopleToWaitingStack(!1,a);var i=e.getMyWaitingRequestFromCurrentStack();if(i){e.myWaitingRequestFromCurrentStack={number:angular.copy(i.attributes.number),displayName:angular.copy(i.attributes.requestedByDisplayName),profilePicture:i.attributes.requestedByProfilePicture?angular.copy(i.attributes.requestedByProfilePicture._url):null,anonymous:angular.copy(i.attributes.requestedByAnonymous),location:angular.copy(i.attributes.location),createdAt:angular.copy(i.createdAt),savedTimeSeconds:moment().utc().diff(moment.utc(i.createdAt),"seconds"),comeThereAt:angular.copy(i._serverData.comeThereAt),comment:angular.copy(i._serverData.requestedByComment),resolvedAt:angular.copy(i.createdAt),howManyBeforeMe:e.waitingPeopleAll.indexOf(i)},l.info("Get comment from backend"),e.myWaitingRequestFromCurrentStack.comment?t.CurrentSelectedWaitingLine.waitingLineRequestComment=angular.copy(e.myWaitingRequestFromCurrentStack.comment):t.CurrentSelectedWaitingLine&&(t.CurrentSelectedWaitingLine.waitingLineRequestComment="");var u=function(){e.myWaitingRequestFromCurrentStack.savedTimeSeconds+=1;var t=parseInt(e.myWaitingRequestFromCurrentStack.savedTimeSeconds),n=t/3600>>0;10>n&&(n="0"+n),t%10===0&&l.info("Seconds",t),t-=3600*n;var a=t/60>>0;10>a&&(a="0"+a),t-=60*a,10>t&&(t="0"+t),e.myWaitingRequestFromCurrentStack.savedTime=n+":"+a+":"+t};t.CurrentSelectedWaitingLine&&e.currentUser._serverData.isResolver&&t.CurrentSelectedWaitingLine._serverData.resolvers.indexOf(e.currentUser._serverData.email)>-1||(u(),t.savedTimeRefreshInterval||e.myWaitingRequestFromCurrentStack.comeThereAt||(t.savedTimeRefreshInterval=o(function(){e.myWaitingRequestFromCurrentStack.comeThereAt||u()},1e3)))}var c=function(){b.then(function(n){var a=new n.DirectionsService;if(t.myPosition&&t.myPosition.coords&&e.myWaitingRequestFromCurrentStack&&e.myWaitingRequestFromCurrentStack.location){e.myWaitingRequestFromCurrentStack.location&&e.myWaitingRequestFromCurrentStack.location.latitude.toFixed(3)===t.myPosition.coords.latitude.toFixed(3)&&e.myWaitingRequestFromCurrentStack.location.longitude.toFixed(3)===t.myPosition.coords.longitude.toFixed(3)||t.UpdateCurrentWaitingLineRequest(!0);var i=new n.LatLng(t.myPosition.coords.latitude,t.myPosition.coords.longitude),s=new n.LatLng(t.CurrentSelectedWaitingLine.attributes.location.latitude,t.CurrentSelectedWaitingLine.attributes.location.longitude),r={origin:i,destination:s,travelMode:n.TravelMode.DRIVING};a.route(r,function(r){r.routes&&r.routes.length&&e.$apply(function(){if(e.myWaitingRequestFromCurrentStack.distance=r.routes[0].legs[0].distance.text,e.myWaitingRequestFromCurrentStack.durationIfDriving=r.routes[0].legs[0].duration.text,r.routes[0].legs[0].distance.value<50)l.info("Distance meters",r.routes[0].legs[0].distance.value),e.myWaitingRequestFromCurrentStack.distance=r.routes[0].legs[0].distance.value+" m",e.InformUserComeThere(),console.log(e.myWaitingRequestFromCurrentStack,t.CurrentSelectedWaitingLine);else{if(r.routes[0].legs[0].distance.value<5e3){var o={origin:i,destination:s,travelMode:n.TravelMode.BICYCLING};a.route(o,function(t){t.routes&&t.routes.length&&e.$apply(function(){e.myWaitingRequestFromCurrentStack.durationIfBicycling=t.routes[0].legs[0].duration.text})})}if(r.routes[0].legs[0].distance.value<3e3){var u={origin:i,destination:s,travelMode:n.TravelMode.WALKING};a.route(u,function(t){t.routes&&t.routes.length&&e.$apply(function(){e.myWaitingRequestFromCurrentStack.durationIfWalking=t.routes[0].legs[0].duration.text})})}}})})}}),t.checkIsDisabledUpdateRequest()};t.CurrentSelectedWaitingLine&&e.currentUser&&e.currentUser._serverData.isResolver&&t.CurrentSelectedWaitingLine._serverData.resolvers.indexOf(e.currentUser._serverData.email)>-1||(s(c,700),e.calculateParamsFromPositionInterval||(e.calculateParamsFromPositionInterval=o(function(){l.info("Recalculate position params"),c()},6e4)))}}))},t.checkIsDisabledUpdateRequest=function(){l.info("checkIsDisabledUpdateRequest"),e.currentUser=g.getCurrentUser(),e.isDisabledUpdateRequest=!1,e.myWaitingRequestFromCurrentStack&&(!e.currentUser._serverData.beAnonymousKeepPrivate==!e.myWaitingRequestFromCurrentStack.anonymous&&(e.currentUser._serverData.beAnonymousKeepPrivate?e.isDisabledUpdateRequest=!0:e.currentUser._serverData.displayName!==e.myWaitingRequestFromCurrentStack.displayName||e.currentUser._serverData.profilePictureThumbnail&&e.currentUser._serverData.profilePictureThumbnail._url!==e.myWaitingRequestFromCurrentStack.profilePicture||(e.isDisabledUpdateRequest=!0)),l.info(t.CurrentSelectedWaitingLine.waitingLineRequestComment,e.myWaitingRequestFromCurrentStack.comment),t.CurrentSelectedWaitingLine.waitingLineRequestComment&&t.CurrentSelectedWaitingLine.waitingLineRequestComment!==e.myWaitingRequestFromCurrentStack.comment&&(e.isDisabledUpdateRequest=!1))},e.LoadMorePeopleToWaitingStack=function(t,n){t&&(C=t);var a=[];e.waitingPeople=[];for(var i=0;C-1>i;i++)e.waitingPeopleAll[i]&&a.push(e.waitingPeopleAll[i]);l.info("waitingPeopleSliced",a),e.waitingPeople=a,e.waitingPeopleIsPrepared=!1,e.waitingPeopleLoadInProgress=!0,l.info("Force timeout",n),n?s(function(){e.waitingPeopleLoadInProgress&&(e.waitingPeopleLoadInProgress=!1),e.waitingPeopleIsPrepared=!0},1500):(e.waitingPeopleLoadInProgress&&(e.waitingPeopleLoadInProgress=!1),e.waitingPeopleIsPrepared=!0),e.hasMorePeople=e.waitingPeopleAll.length<C?!1:!0,C+=E},e.getMyWaitingRequestFromCurrentStack=function(){for(var t=e.currentUser,n=e.waitingPeopleAll,a=0;a<n.length;a++)if(t&&t.id===n[a].attributes.requestedBy.id)return n[a];return null},e.GoToCreateNewLine=function(){n.go("newLine")
},e.GoToDashboardByHostname=function(e){l.info("GoToDashboardByHostname"),n.go("dashboardByHostname",{lineHostname:e._serverData.hostname.replace(/\./g,"")})}}]),angular.module("saveTime").constant("ConfigConst",{copyRightTitle:"SaveTime",copyRightYear:"2016"}),angular.module("saveTime").run(["$templateCache",function(e){e.put("app/dashboard/dashboard.html",'<md-content class="dashboard" id="dashboard-container"><div ng-controller="NavbarCtrl"><div ng-include="\'app/components/navbar/navbar.html\'"></div></div><div class="main-screen container-fluid" ng-show="isMainScreenFullscreen" fullscreen="isMainScreenFullscreen"><md-toolbar md-scroll-shrink=""><div class="md-toolbar-tools"><h3><div ng-show="CurrentSelectedWaitingLine._serverData.iconThumbnail._url" class="icon-div" style="background-image: url({{CurrentSelectedWaitingLine._serverData.iconThumbnail._url}})"></div><span>{{CurrentSelectedWaitingLine._serverData.title}}</span></h3></div></md-toolbar><div class="body"><div ng-controller="GetNumberWebCamCtrl"><form ng-submit="makeSnapshot(); StandInLineGlobal()"><div class="form-group display-name"><input type="text" class="form-control" placeholder="{{ \'DASHBOARD_TERMINAL_INSERT_DISPLAY_NAME\' | translate }}" ng-model="anonymous.displayName" ng-click="NewVisitorWantToEnter()" ng-disabled="standInLineGlobalInProgress"></div><div ng-show="standInLineGlobalInProgress || standInLineGlobalMessage"><span translate="DASHBOARD_TERMINAL_YOUR_NUMBER_IS"></span> <span ng-show="standInLineGlobalInProgress">...</span> <b><span ng-show="standInLineGlobalMessage">{{standInLineGlobalMessage}}</span></b></div><md-button ng-disabled="standInLineGlobalInProgress || standInLineGlobalMessage || !anonymous.displayName || anonymous.displayName.length < 3" class="md-raised md-warn"><span translate="DASHBOARD_TERMINAL_GET"></span><br><span translate="DASHBOARD_TERMINAL_NUMBER"></span></md-button><webcam ng-if="CurrentSelectedWaitingLine && CurrentSelectedWaitingLine._serverData.cameraRequestEnabled && currentUser._serverData.isResolver && CurrentSelectedWaitingLine._serverData.resolvers.indexOf(currentUser._serverData.email) > -1" on-stream="onStream(stream)" on-error="onError(err)" on-streaming="onSuccess()" channel="channel" ng-class="{ \'webcam-hidden\': !channel.video }" placeholder="\'assets/images/ajax-loader.gif\'"><div class="alert alert-error" ng-show="false"><span>Webcam could not be started. Did you give access to it?</span></div></webcam><canvas id="snapshot"></canvas></form></div></div></div><div class="main container-fluid" ng-resize="setDimensions($event)" ng-show="currentUser" du-scroll-container=""><div class="row main-row" ng-class="{ \'not-selected\': !CurrentSelectedWaitingLine }"><div id="waiting-line-list" ng-class="{ \'selected\': CurrentSelectedWaitingLine }" class="col-md-4"><div ng-controller="FindLineCtrl as ctrl" class="find-lines"><md-toolbar class="md-theme-dark md-warn"><h2 class="md-toolbar-tools"><span>Waiting lines</span></h2></md-toolbar><md-content><form ng-show="true" class="form-inline search-form" ng-submit="Search()"><div class="form-group"><input type="text" class="form-control search-control" ng-model="searchQuery" ng-disabled="myPositionError || isWaitingLineLoadedByHostname" placeholder="{{searchPlaceholder}}" style="width: {{searchInputWidth}}px"></div><div class="form-group search-group"><button class="btn btn-default" type="submit"><span class="glyphicon glyphicon-search" aria-hidden="true"></span> Search</button></div></form></md-content><md-content class="no-my-position" ng-show="!myPositionError && !myPosition && !lines.length">Loading...</md-content><md-content class="no-my-position" ng-show="myPositionError">To search waiting lines, you should allow location sharing!<br><br>1. Enable GPS<br>2. Remove restriction for location sharing<br><div ng-show="DEVICE.isMobile()"><a href="https://support.google.com/gmm/answer/1250068?hl=en" target="_blank">How to remove restriction?</a></div>3. Refresh browser<br>4. Click on allow when browser prompt you</md-content><md-content class="empty-search" ng-show="!searchInProgress && myPosition && lines && lines.length === 0 && searchQuery !== null">No results for this search query!<br><span ng-show="myPosition">Search return only waiting lines which are maximum away 100 kilometers from your location!</span></md-content><md-content class="empty-search" ng-show="!zeroAvailableWaitingLines && myPosition && lines && lines.length === 0 && searchQuery === null">Waiting lines are loading...</md-content><md-content class="empty-search" ng-show="!myPositionError && searchInProgress">Search in progress...</md-content><md-content class="empty-search" ng-show="!myPositionError && firstWaitingLineGetDone && zeroAvailableWaitingLines">There is zero available waiting lines for your location. Stand to lines is available only if line is maximum away 100 kilometers from your location. Please come back later when someone creates first line or you can be first who will create line in your neighbourhood, click <a ng-click="GoToCreateNewLine()" class="new-line-link">here</a> for new waiting line.</md-content><md-content ng-show="!myPositionError && lines.length > 0"><md-list><md-list-item class="md-2-line line" ng-class="{ selected: line.id === CurrentSelectedWaitingLine.id }" ng-repeat="line in lines" ng-click="GoToDashboardByHostname(line)" ng-show="!currentUser._serverData.isMachine || (line._serverData.resolvers.indexOf(currentUser._serverData.email) > -1)"><img ng-src="{{line.attributes.iconThumbnail._url}}" class="md-avatar" alt="{{line.display}}"><div class="md-list-item-text"><h3>{{line.attributes.title}}</h3><h4>{{line.attributes.address}}</h4></div><md-divider></md-divider></md-list-item></md-list></md-content><md-content class="load-more-content" ng-show="myPosition && hasMoreLines && lines && lines.length > 0"><md-button ng-click="LoadMoreLines()" class="md-raised md-warn load-more-btn">Load more lines</md-button></md-content></div></div><div id="waiting-line-actions-container" class="col-md-4" ng-hide="searchResultIsEmpty"><div ng-controller="WaitingLineActionCtrl" class="waiting-line-actions"><md-toolbar class="md-theme-dark" ng-class="{ \'md-warn\': !CurrentSelectedWaitingLine, \'md-accent\': CurrentSelectedWaitingLine, }"><h2 class="md-toolbar-tools"><span><span class="mobile-hide" ng-show="!searchInProgress && (!CurrentSelectedWaitingLine || !CurrentSelectedWaitingLinePrepared)" ng-class="{ \'is-prepared\': !CurrentSelectedWaitingLinePrepared }">Not selected waiting line</span><div class="mobile-hide" ng-class="{ \'is-prepared\': CurrentSelectedWaitingLinePrepared }"><img ng-show="CurrentSelectedWaitingLine" ng-src="{{CurrentSelectedWaitingLine.attributes.iconThumbnail._url}}" class="line-icon" alt="{{CurrentSelectedWaitingLine.attributes.title}}" ng-click="GoToDashboardByHostname(CurrentSelectedWaitingLine)"> <span ng-show="CurrentSelectedWaitingLine && !CurrentSelectedWaitingLine._serverData.active" class="label label-danger label-inactive">INACTIVE</span> <span ng-show="CurrentSelectedWaitingLine" class="title">{{CurrentSelectedWaitingLine.attributes.title}}</span></div></span></h2></md-toolbar><md-content class="empty-search" ng-show="(CurrentSelectedWaitingLine._serverData.remoteEnabled === true || myWaitingRequestFromCurrentStack) && waitingPeopleLoadInProgress">Loading...</md-content><md-content ng-show="CurrentSelectedWaitingLine && CurrentSelectedWaitingLine._serverData.active === true && currentUser._serverData.isResolver && CurrentSelectedWaitingLine._serverData.resolvers.indexOf(currentUser._serverData.email) > -1" class="actions-container" ng-class="{ loaded: !waitingPeopleLoadInProgress }"><md-button ng-show="!waitingPeopleLoadInProgress" id="open-get-number-screen" ng-click="toggleMainScreenFullscreen()" class="md-raised stand-in-line-btn md-primary"><span class="glyphicon glyphicon glyphicon-fullscreen" aria-hidden="true"></span> <span>Open get number screen</span></md-button></md-content><md-content class="actions-container" ng-class="{ loaded: !waitingPeopleLoadInProgress }" ng-show="CurrentSelectedWaitingLine && !CurrentSelectedWaitingLine._serverData.active"><div ng-show="!CurrentSelectedWaitingLine._serverData.nonActiveMessage">This waiting line is currently inactive, number getting is temporarily disabled!</div><div ng-bind-html="CurrentSelectedWaitingLine._serverData.nonActiveMessage"></div></md-content><md-content class="actions-container loaded" ng-show="CurrentSelectedWaitingLine && !waitingPeopleLoadInProgress && CurrentSelectedWaitingLine._serverData.active === true && !CurrentSelectedWaitingLine._serverData.remoteEnabled && !myWaitingRequestFromCurrentStack && !(currentUser._serverData.isResolver && CurrentSelectedWaitingLine._serverData.resolvers.indexOf(currentUser._serverData.email) > -1) || (!waitingPeopleLoadInProgress && (CurrentSelectedWaitingLine._serverData.clients.indexOf(currentUser._serverData.email) < 0) ) || (waitingPeopleAll.length <= 1)"><div ng-show="!CurrentSelectedWaitingLine._serverData.nonRemoteEnabledMessage">This waiting line has disabled remote requests number getting is enabled only at location!</div><div ng-bind-html="CurrentSelectedWaitingLine._serverData.nonRemoteEnabledMessage"></div></md-content><md-content ng-show="CurrentSelectedWaitingLine && CurrentSelectedWaitingLine._serverData.active === true && (CurrentSelectedWaitingLine._serverData.remoteEnabled === true || myWaitingRequestFromCurrentStack) && !(currentUser._serverData.isResolver && CurrentSelectedWaitingLine._serverData.resolvers.indexOf(currentUser._serverData.email) > -1) && (CurrentSelectedWaitingLine._serverData.clients.indexOf(currentUser._serverData.email) > -1) && (waitingPeopleAll.length <= 1)" class="actions-container" ng-class="{ loaded: !waitingPeopleLoadInProgress }"><div class="update-note" ng-show="!waitingPeopleLoadInProgress && myWaitingRequestFromCurrentStack && !isDisabledUpdateRequest">You have changes in your request after stand in line!</div><div class="comment" ng-hide="waitingPeopleLoadInProgress" ng-if="false"><div class="form-group"><input type="text" class="form-control" ng-model="CurrentSelectedWaitingLine.waitingLineRequestComment" ng-change="checkIsDisabledUpdateRequest()" placeholder="Enter optional message for resolver"></div></div><md-button ng-show="!waitingPeopleLoadInProgress" ng-click="StandInLine()" ng-disabled="isDisabledUpdateRequest || disableNextRequest" class="md-raised stand-in-line-btn" ng-class="{ \'md-primary\': !myWaitingRequestFromCurrentStack, \'md-accent\': myWaitingRequestFromCurrentStack }"><span ng-show="!myWaitingRequestFromCurrentStack"><span class="text">Stand in line</span><br><span class="glyphicon glyphicon-user" aria-hidden="true"></span> <span class="glyphicon glyphicon-user" aria-hidden="true"></span> <span class="glyphicon glyphicon-user" aria-hidden="true"></span> <span class="glyphicon glyphicon-user" aria-hidden="true"></span> <span class="glyphicon glyphicon-user selected-icon" aria-hidden="true"></span><br><span class="text">and get your number</span></span> <span ng-show="myWaitingRequestFromCurrentStack"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Update my request<br>with new data</span></md-button><div ng-show="!waitingPeopleLoadInProgress && myWaitingRequestFromCurrentStack" class="row my-request-details"><div class="col-xs-12"><span class="data-container"><span class="data-text">My&nbsp;number&#58;</span> <span class="data-value">{{myWaitingRequestFromCurrentStack.number}}</span></span> <span class="data-container"><span class="data-text">People&nbsp;before&nbsp;me&#58;</span> <span class="data-value no-border">{{myWaitingRequestFromCurrentStack.howManyBeforeMe}}</span></span> <span class="data-container"><span class="data-text data-text-xs data-text-times">Get&nbsp;number&#58;<br>Come&nbsp;there&#58;<br>Saved&nbsp;time&#58;</span> <span class="data-value data-value-xs data-text-value">{{myWaitingRequestFromCurrentStack.createdAt | date:\'dd.MM.yyyy. HH:mm:ss\'}}<br>{{(myWaitingRequestFromCurrentStack.comeThereAt | date:\'dd.MM.yyyy. HH:mm:ss\')}}<span ng-show="!myWaitingRequestFromCurrentStack.comeThereAt"><a href="" class="btn btn-success btn-xs needsclick" ng-click="UpdateComeThere()" ng-disabled="updateComeThereInProgress">CLICK IF ARRIVED NOW</a></span><br>{{myWaitingRequestFromCurrentStack.savedTime}}</span></span> <span class="data-container" ng-show="myWaitingRequestFromCurrentStack.distance"><span class="data-text">Estimated<br>waiting time&#58;</span> <span class="data-value data-value-xs data-text-value">COMING SOON<br>This feature is<br>in development!</span></span> <span class="data-container" ng-show="myWaitingRequestFromCurrentStack.distance"><span class="data-text">Distance&#58;</span> <span class="data-value data-value-sm">{{myWaitingRequestFromCurrentStack.distance}}</span></span> <span class="data-container" ng-show="myWaitingRequestFromCurrentStack.durationIfDriving"><span class="data-text">Driving&#58;</span> <span class="data-value data-value-sm">{{myWaitingRequestFromCurrentStack.durationIfDriving}}</span></span> <span class="data-container" ng-show="myWaitingRequestFromCurrentStack.durationIfBicycling"><span class="data-text">Bicycling&#58;</span> <span class="data-value data-value-sm">{{myWaitingRequestFromCurrentStack.durationIfBicycling}}</span> <span ng-show="!myWaitingRequestFromCurrentStack.durationIfBicycling" class="data-value data-value-sm">Not recommended</span></span> <span class="data-container" ng-show="myWaitingRequestFromCurrentStack.durationIfWalking"><span class="data-text">Walking&#58;</span> <span class="data-value data-value-sm">{{myWaitingRequestFromCurrentStack.durationIfWalking}}</span></span></div></div><md-button ng-show="!waitingPeopleLoadInProgress && myWaitingRequestFromCurrentStack" ng-click="CancelMyRequest()" ng-disabled="disableNextRequest" class="md-raised md-warn cancel-my-request-btn"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span> <span>Cancel my request<br>Get out from waiting line</span></md-button></md-content></div></div><div id="waiting-line-container" class="col-md-4 mobile-hide" ng-hide="searchResultIsEmpty || !CurrentSelectedWaitingLine._serverData.active" ng-class="{ \'is-prepared\': CurrentSelectedWaitingLinePrepared && CurrentSelectedWaitingLine }"><div ng-controller="WaitingLineCtrl" class="waiting-line"><md-toolbar class="md-theme-dark" ng-class="{ \'md-warn\': !CurrentSelectedWaitingLine, \'md-accent\': CurrentSelectedWaitingLine, }"><h2 class="md-toolbar-tools"><span><span ng-show="CurrentSelectedWaitingLine">People who wait in line <span ng-show="waitingPeopleAll.length >= 0">({{waitingPeopleAll.length}})</span></span></span> <span ng-show="CurrentSelectedWaitingLine && !blockNextRequest" ng-click="RefreshWaitingLine(false, true)" class="btn btn-default refresh-line-btn needsclick"><span class="glyphicon glyphicon-refresh" ng-class="{ rotate: waitingPeopleLoadInProgress }" aria-hidden="true"></span></span></h2></md-toolbar><md-content class="empty-search people-loading-container" ng-show="CurrentSelectedWaitingLine && waitingPeopleLoadInProgress">Loading...</md-content><md-content class="empty-search" ng-show="CurrentSelectedWaitingLine && waitingPeople.length === 0 && waitingPeopleIsPrepared && !waitingPeopleLoadInProgress">Waiting line is empty, no one is waiting.</md-content><md-content ng-show="!waitingPeopleLoadInProgress && CurrentSelectedWaitingLine && waitingPeople.length && waitingPeopleIsPrepared"><md-list><md-list-item class="" ng-repeat="person in waitingPeople" ng-class="{ \'current-user\': currentUser.id === person._serverData.requestedBy.id }"><img ng-show="person._serverData.requestedByAnonymous || !person._serverData.requestedByProfilePicture" src="/assets/images/user-icon.png" class="md-avatar"> <img ng-show="!person._serverData.requestedByAnonymous && person._serverData.requestedByProfilePicture" ng-src="{{person._serverData.requestedByProfilePicture._url}}" class="md-avatar"> <span class="number">{{person._serverData.number}}</span><div class="md-list-item-text"><span ng-show="!person._serverData.requestedByAnonymous && person._serverData.requestedByDisplayName">{{person._serverData.requestedByDisplayName}}</span> <span ng-show="!person._serverData.requestedByAnonymous && !person._serverData.requestedByDisplayName">No display name</span> <span ng-show="person._serverData.requestedByAnonymous">Keep privacy - Anonymous user</span></div><md-divider></md-divider></md-list-item></md-list></md-content><md-content class="load-more-content" ng-show="!waitingPeopleLoadInProgress && CurrentSelectedWaitingLine && hasMorePeople && waitingPeople.length && waitingPeopleIsPrepared"><md-button ng-click="LoadMorePeople()" class="md-raised md-warn load-more-btn needsclick">Load more people</md-button></md-content></div></div></div></div><div ng-controller="FooterCtrl"><div ng-include="\'app/components/footer/footer.html\'"></div></div></md-content>'),e.put("app/landing/landing.html",'<style type="text/css">\n  body {\n    background: #000;\n  }\n</style><div layout="vertical" class="landing" layout-fill=""><md-content><div class="main"><div class="top"><div class="head"><img src="assets/images/title.png" class="title"></div><div class="subtitle">Remotely wait for <b>your turn</b> in queues at the doctor, hairdresser, museum and in any other waiting line!</div></div><div class="store-icons"><div class="title">Web application is <b>LIVE</b> and you can use it!</div><div class=""><button type="button" class="btn btn-danger btn-lg needsclick" ng-click="OpenApp()"><span class="mobile-hidden"><b>CREATE</b> or</span>&nbsp;<b>FIND</b> your <b>waiting line</b>!</button></div></div><div class="store-icons subtitle"><b>Make money</b> and never wait <b>in line</b> again!</div><div class="waiting-list"><form class="row" ng-show="WaitingListSubmitted === \'NO\'" ng-submit="KeepMeUpdated()"><div class="col-sm-7"><input type="email" ng-model="email" validate-email="true" class="form-control input-lg" placeholder="Enter your email address" id="email"> <label ng-show="emailValidationLabel">Email should be in correct format</label></div><div class="col-sm-5"><button type="submit" ng-class="{ marginTop0: !emailValidationLabel }" class="btn btn-success btn-block btn-lg">Keep me updated</button></div></form><div ng-show="WaitingListSubmitted === \'YES\' || WaitingListSubmitted === \'ERROR\'"><h1>Thank you for signing up.</h1><h2>We\'ll send an email to <span>{{email}}</span> with new info soon.</h2><div><a ng-click="OpenPopUpFacebook(\'https://www.facebook.com/sharer/sharer.php?app_id=114545895322903&sdk=joey&u=http%3A%2F%2Fsavetime.io%2F&display=popup&ref=plugin&src=share_button\')" class="facebook-share">Share on Facebook</a> <a ng-click="OpenPopUpTwitter(\'https://twitter.com/intent/tweet?screen_name=savetimeio&text=SaveTime%20-%20mobile/web%20app%20with%20which%20you%20%20never%20have%20to%20wait%20in%20line%20again!%20-%20http://savetime.io\')" class="twitter-share">Share on Twitter</a></div><div class="fb-share-button" data-href="https://savetime.io" data-layout="box_count"></div></div></div><div class="store-icons"><div class="title">Usage is <b>FREE</b> during <b>BETA</b> testing!</div><div class="subtitle">Every feedback is appreciated, feel free to contact us at<br><a href="mailto:savetime@savetime.io?Subject=Feedback" class="mail-link">savetime@savetime.io</a></div><div class="subtitle">Soon, will be available at the most popular mobile app stores!</div><img src="assets/images/google-play-icon.png"> <img src="assets/images/app-store-icon.png"> <img src="assets/images/windows-store-icon.png"></div><div ng-controller="FooterCtrl"><div ng-include="\'app/components/footer/footer.html\'"></div></div></div></md-content></div>'),e.put("app/login/login.html",'<style type="text/css">\n  @media screen and (min-height: 569px) {\n    body {\n      background-color: #0D47A1;\n    }\n  }\n</style><md-content class="login"><div ng-controller="NavbarCtrl"><div ng-include="\'app/components/navbar/navbar.html\'"></div></div><div class="main container"><div class="top-title title md-headline">Welcome to Save<b>Time</b> and enjoy!</div><div class="title md-headline"><b>Make money</b> and never wait <b>in line</b> again!</div><md-content md-theme="default" layout-padding="" layout="row" layout-align="space-around center" layout-sm="column"><form ng-submit="Authenticate(\'login\')" name="login"><md-input-container flex=""><label>Email</label> <input required="" type="email" ng-pattern="emailRegex" name="email" ng-model="user.email"><div ng-messages="login.email.$error"><div ng-message="required">This is required.</div><div ng-message="pattern">Email is in incorrect format!</div></div></md-input-container><md-input-container flex=""><label>Password</label> <input required="" ng-model="user.password" name="password" type="password"><div ng-messages="login.password.$error"><div ng-message="required">This is required.</div></div></md-input-container><input type="submit" style="visibility: hidden"></form></md-content><div layout="column" layout-fill="" ng-show="ErrorMessage"><md-whiteframe class="md-whiteframe-z3 md-button md-default-theme message error-message" layout="" layout-align="center center"><span ng-bind-html="ErrorMessage"></span></md-whiteframe></div><div layout="column" layout-fill="" ng-show="SuccessMessage"><md-whiteframe class="md-whiteframe-z3 md-button md-default-theme message success-message" layout="" layout-align="center center"><span ng-bind-html="SuccessMessage"></span></md-whiteframe></div><section layout="row" layout-sm="column" layout-align="center center"><md-button class="md-raised md-accent signup" ng-click="Authenticate(\'signup\')" flex="">Sign up</md-button><md-button class="md-raised md-primary login" ng-click="Authenticate(\'login\')" flex="">Login</md-button></section><section layout="row" layout-sm="column" layout-align="center center"><md-button class="md-primary" ng-click="Authenticate(\'reset\')" flex="">Reset password</md-button></section></div><div ng-controller="FooterCtrl"><div ng-include="\'app/components/footer/footer.html\'"></div></div></md-content>'),e.put("app/myLines/messagesDialog.tmpl.html",'<md-dialog aria-label="Messages" class="my-lines-messages-dialog"><form><md-toolbar><div class="md-toolbar-tools"><h2>Define messages&#58; &quot;{{line.attributes.title}}&quot;</h2><span flex=""></span><md-button class="md-icon-button" ng-click="answer(\'close\')"><md-icon md-svg-src="assets/images/ic_close_24px.svg" aria-label="Close dialog"></md-icon></md-button></div></md-toolbar><md-dialog-content><h3>Public message when waiting line is not active:</h3><text-angular ng-model="line.attributes.nonActiveMessage"></text-angular><h3>Public message when waiting line has not enabled remote stand in line:</h3><text-angular ng-model="line.attributes.nonRemoteEnabledMessage"></text-angular></md-dialog-content><div class="md-actions" layout="row"><md-button ng-click="answer(\'cancel\')" class="md-primary">Cancel</md-button><md-button ng-click="answer(\'update\')" class="md-primary">Save</md-button></div></form></md-dialog>'),e.put("app/myLines/myLines.html",'<md-content class="my-lines"><div ng-controller="NavbarCtrl"><div ng-include="\'app/components/navbar/navbar.html\'"></div></div><div class="main container-fluid"><div class="row"><div class="col-md-12" ng-show="!hasLines">You do not have any waiting line, click <a ng-click="GoToCreateNewLine()" class="new-line-link">here</a> to create first one.</div><table ng-table="tableParams" class="table" ng-show="data.length > 0"><tr ng-repeat="line in data" ng-escape="line.$edit = false" ng-enter="line.$edit = false; SaveLine(line)"><td data-title="\'No.\'" width="30" class="line-number" ng-class="{ active: line.$edit }"><span>{{$index + 1}}.</span></td><td data-title="\'Icon\'" width="70" class="icon" ng-class="{ active: line.$edit }"><div ng-show="!line.icon.base64" class="icon-div" style="background-image: url({{line.attributes.iconThumbnail._url}})"></div><div ng-show="line.icon.base64" class="icon-div" style="background-image: url({{line.icon.base64}})"></div><span ng-if="line.$edit" class="btn btn-sm btn-block btn-file" ng-class="{ \'btn-danger\': !line.icon.base64, \'btn-success\': line.icon.base64 }"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span> &nbsp; Pick <input ng-if="line.$edit" type="file" accept="image/*" onclick="this.value = null" file-ng-change="browseIcon(selectedFileList, line)"></span></td><td data-title="\'Active\'" width="70" class="active-flag" ng-class="{ active: line.$edit }"><input type="checkbox" ng-disabled="!line.$edit" ng-model="line.attributes.active"><br><span ng-show="!line._serverData.approved"><span class="label label-warning label-help" data-toggle="tooltip" data-placement="top" data-title="SaveTime admin should review and approve this waiting line before it become available in the system." bs-tooltip="">Not approved</span></span> <span class="label label-danger label-help" ng-show="line._serverData.suspended" data-toggle="tooltip" data-placement="top" data-title="SaveTime admin suspended this waiting line, please contact support for more informations." bs-tooltip="">Suspended</span></td><td data-title="\'Ads&nbsp;enabled\'" width="70" class="ads-enabled-flag" ng-class="{ active: line.$edit }"><input type="checkbox" ng-disabled="!line.$edit" ng-model="line.attributes.adsEnabled"><br><span class="label label-warning label-help" data-toggle="tooltip" data-placement="top" data-title="This feature is currently in development and will be available in the future!" bs-tooltip="">SOON</span></td><td data-title="\'Remote&nbsp;enabled\'" width="70" class="remote-enabled-flag" ng-class="{ active: line.$edit }"><input type="checkbox" ng-disabled="!line.$edit" ng-model="line.attributes.remoteEnabled"><br></td><td data-title="\'Title\'" class="title" ng-class="{ active: line.$edit }"><span ng-if="!line.$edit">{{line.attributes.title}}</span><div ng-if="line.$edit"><input class="form-control" type="text" ng-model="line.attributes.title"></div></td><td data-title="\'Address\'" class="address" ng-class="{ active: line.$edit }"><span ng-if="!line.$edit">{{line.attributes.address}}</span><div ng-if="line.$edit"><input class="form-control" type="text" ng-model="line.attributes.address"></div></td><td data-title="\'Domain\'" class="domain" ng-class="{ active: line.$edit }"><span ng-if="!line.$edit">{{line.attributes.hostname}}</span><div ng-if="line.$edit"><input class="form-control" type="text" ng-change="line.attributes.hostname = TransformHostName(line.attributes.hostname)" ng-model="line.attributes.hostname"></div></td><td data-title="\'Counter\'" width="70" class="counter" ng-class="{ active: line.$edit }">{{line._serverData.counter}}</td><td data-title="\'Created\'" class="created-at" ng-class="{ active: line.$edit }"><span>{{line.createdAt | date:\'dd.MM.yyyy. HH:mm:ss\'}}</span></td><td data-title="\'Updated\'" class="updated-at" ng-class="{ active: line.$edit }"><span>{{line.updatedAt | date:\'dd.MM.yyyy. HH:mm:ss\'}}</span></td><td data-title="\'Actions\'" class="actions" ng-class="{ active: line.$edit }"><a ng-if="!line.$edit" href="" class="btn btn-default btn-xs" ng-click="line.$edit = true">Edit</a> <a ng-if="!line.$edit" ng-href="http://{{line.attributes.hostname}}" class="btn btn-default btn-xs" target="_blank">URL</a> <a ng-if="line.$edit" href="" class="btn btn-primary btn-xs" ng-click="line.$edit = false; SaveLine(line)">Save</a> <a ng-if="line.$edit" href="" class="btn btn-default btn-xs" ng-click="ChooseResolvers($event, line)">Resolvers</a> <a ng-if="line.$edit" href="" class="btn btn-default btn-xs" ng-click="DefineMessages($event, line)">Messages</a> <a ng-if="line.$edit" href="" class="btn btn-default btn-xs" ng-click="line.$edit = false">Cancel</a> <a ng-show="!line._serverData.active" data-toggle="tooltip" data-placement="top" data-title="Warning: click on this button will reset current line number to zero. Counter=0" bs-tooltip="" href="" class="btn btn-danger btn-xs" ng-click="ResetCounter(line)">Reset counter</a> <a ng-show="line._serverData.active" data-toggle="tooltip" data-placement="top" data-title="This line is active, only at inactive line counter can be reset." bs-tooltip="" href="" class="btn btn-danger btn-xs custom-disabled">Reset counter</a></td></tr></table><div class="load-more-container"><md-button ng-show="hasMoreLines" ng-click="LoadMoreLines()" class="md-raised md-warn load-more-btn">Load more lines</md-button></div></div></div><div ng-controller="FooterCtrl"><div ng-include="\'app/components/footer/footer.html\'"></div></div></md-content>'),e.put("app/myLines/resolversDialog.tmpl.html",'<md-dialog aria-label="Resolvers" class="my-lines-resolvers-dialog"><form><md-toolbar><div class="md-toolbar-tools"><h2>Choose waiting line resolvers&#58; &quot;{{line.attributes.title}}&quot;</h2><span flex=""></span><md-button class="md-icon-button" ng-click="answer(\'close\')"><md-icon md-svg-src="assets/images/ic_close_24px.svg" aria-label="Close dialog"></md-icon></md-button></div></md-toolbar><md-dialog-content><div ng-show="line.resolvers.length <= 0" class="col-md-11"><h3>No resolvers!</h3><p>You are the only user who can resolve this waiting line.</p></div><div><form class="form-horizontal"><div class="form-group email-container" ng-repeat="resolver in line.resolvers track by $index"><div class="col-md-10"><input type="email" required="required" class="form-control" ng-model="line.resolvers[$index]" placeholder="Resolver\'s email"></div><div class="col-md-2"><span class="glyphicon glyphicon-remove" ng-click="line.resolvers.splice($index,1)" aria-hidden="true"></span></div></div><div class="col-md-11"><md-button ng-click="AddNewResolver()" class="md-accent md-raised">Add resolver</md-button></div></form></div></md-dialog-content><div class="md-actions" layout="row"><md-button ng-click="answer(\'cancel\')" class="md-primary">Cancel</md-button><md-button ng-click="answer(\'update\')" class="md-primary">Save</md-button></div></form></md-dialog>'),e.put("app/newLine/newLine.html",'<md-content class="new-line"><div ng-controller="NavbarCtrl"><div ng-include="\'app/components/navbar/navbar.html\'"></div></div><div class="main container-fluid"><div class="row"><div class="col-md-6"><form ng-submit="vm.onSubmit()" name="vm.form"><formly-form model="vm.line" fields="vm.lineFields"><div class="form-group"><label>2. Address *</label> <input type="text" class="form-control" ng-model="vm.line.address" data-delay="5000" bs-options="address.formatted_address as address.formatted_address for address in getAddress(vm.line.address)" placeholder="Street, House number, City" ng-enter="CurrentSelectedAddressToPin(true)" bs-typeahead=""></div><div class="form-group map"><label>3. Location of waiting line</label> <span ng-show="!isMapLoaded" us-spinner="{radius:30, width:8, length: 16}">Map is loading...</span><div><button class="btn btn-primary needsclick" ng-click="$event.preventDefault(); CurrentSelectedAddressToPin()" ng-show="isMapLoaded && currentSelectedAddress && vm.line.address.length > 10">Use pin from current Address</button></div><ui-gmap-google-map options="{ scrollwheel: false }" center="map.center" zoom="map.zoom"><ui-gmap-marker coords="marker.coords" options="marker.options" events="marker.events" idkey="marker.id"></ui-gmap-marker></ui-gmap-google-map><label ng-show="isMapLoaded">NOTE: Drag marker to waiting line location, by this GPS coordinates waiting line search will be optimized.</label></div></formly-form></form></div><div class="col-md-6"><div class="waiting-line-domain"><div class="form-group"><label>4. Waiting line domain *</label><div class="row"><div class="col-md-6"><input type="text" ng-model="vm.line.subdomain" ng-change="TransformSubdomain()" placeholder="Enter custom subdomain" class="form-control"></div><div class="col-md-6"><select selectpicker="" ng-model="vm.line.domain" toggle-dropdown=""><option value="{{domain}}" ng-repeat="domain in vm.domains">{{domain}}</option></select></div></div></div><div class="form-group"><label>Waiting line URL will be:</label> &quot;http://<span ng-if="vm.line.subdomain">{{vm.line.subdomain}}</span><span ng-if="!vm.line.subdomain">???</span>.{{vm.line.domain}}&quot;</div></div><div><label class="control-label">5. Waiting line icon *</label></div><div><label class="control-label" ng-show="!vm.line.icon.base64">Icon is not chosen yet!</label></div><span class="btn btn-block btn-file needsclick" ng-class="{ \'btn-danger\': !vm.line.icon.base64, \'btn-success\': vm.line.icon.base64 }"><span class="glyphicon glyphicon-folder-open needsclick" aria-hidden="true"></span> &nbsp; Choose waiting line icon <input type="file" fileread="iconFile" class="needsclick" accept="image/*" onclick="this.value = null" onchange="angular.element(this).scope().browseIcon(this.files)"></span> <label ng-show="DEVICE.os === \'ios\'" class="control-label">NOTE&#58; from iPhone and iPad upload only image in landscape orientation because of orientation problem with portrait images.</label> <label class="control-label" ng-show="!vm.line.icon.base64">NOTE&#58; icon should has square dimensions, same height and same width, if not system will crop and resize it!</label><div class="icon-container"><div ng-show="vm.line.icon.base64" class="icon-div" style="background-image: url({{vm.line.icon.base64}})"></div><img src="/assets/images/no.png" ng-show="vm.line.icon.base64" class="remove needsclick" alt="X" ng-click="resetIcon()"></div></div></div><div class="row"><div class="col-md-12"><button type="submit" ng-disabled="createInProgress" class="btn btn-block btn-success needsclick" ng-click="trimForm(); vm.submit(vm.line); SubmitForm()">Create new waiting line</button></div></div></div><div ng-controller="FooterCtrl"><div ng-include="\'app/components/footer/footer.html\'"></div></div></md-content>'),e.put("app/resolveLines/clientsDialog.tmpl.html",'<md-dialog aria-label="Clients" class="my-lines-resolvers-dialog"><form><md-toolbar><div class="md-toolbar-tools"><h2>Choose waiting line clients&#58; &quot;{{line.attributes.title}}&quot;</h2><span flex=""></span><md-button class="md-icon-button" ng-click="answer(\'close\')"><md-icon md-svg-src="assets/images/ic_close_24px.svg" aria-label="Close dialog"></md-icon></md-button></div></md-toolbar><md-dialog-content><div ng-show="line.clients.length <= 0" class="col-md-11"><h3>No clients!</h3><p>Add new client with email identificator.</p></div><div><form class="form-horizontal"><div class="col-md-11" style="margin-bottom: 15px;"><md-button ng-click="AddNewClient(true)" class="md-accent md-raised">Add client</md-button></div><div class="form-group email-container" ng-repeat="client in line.clients track by $index"><div class="col-md-10"><input type="email" required="required" class="form-control" ng-model="line.clients[$index]" placeholder="Clients\'s email"></div><div class="col-md-2"><span class="glyphicon glyphicon-remove" ng-click="line.clients.splice($index,1)" aria-hidden="true"></span></div></div><div class="col-md-11"><md-button ng-click="AddNewClient()" class="md-accent md-raised">Add client</md-button></div></form></div></md-dialog-content><div class="md-actions" layout="row"><md-button ng-click="answer(\'cancel\')" class="md-primary">Cancel</md-button><md-button ng-click="answer(\'update\')" class="md-primary">Save</md-button></div></form></md-dialog>'),e.put("app/resolveLines/resolveLines.html",'<md-content class="resolve-lines"><div ng-controller="NavbarCtrl"><div ng-include="\'app/components/navbar/navbar.html\'"></div></div><div class="main container-fluid"><div class="row"><div class="col-md-12"><table ng-table="tableParams" class="table" ng-show="data.length > 0"><tr ng-repeat="line in data"><td data-title="\'No.\'" width="30" class="line-number"><span>{{$index + 1}}.</span></td><td data-title="\'Icon\'" width="150" class="icon"><div class="icon-div" style="background-image: url({{line.attributes.iconThumbnail._url}})"></div></td><td data-title="\'Title\'" class="title">{{line.attributes.title}}</td><td data-title="\'Address\'" class="address">{{line.attributes.address}}</td><td data-title="\'Go to\'" class="actions"><a ng-click="OpenResolvePanel(line)" class="btn btn-success" target="_blank">RESOLVING PANEL</a><br><a ng-href="http://{{line.attributes.hostname}}" class="btn btn-primary btn-xs" target="_blank">PUBLIC PANEL</a></td></tr></table></div></div></div><div ng-controller="FooterCtrl"><div ng-include="\'app/components/footer/footer.html\'"></div></div></md-content>'),e.put("app/resolveLines/resolveLinesPanel.html",'<md-content class="resolve-lines-panel"><div ng-controller="NavbarCtrl"><div ng-include="\'app/components/navbar/navbar.html\'"></div></div><div class="main-mobile"><div class="next-request-container"><a ng-click="NextRequest()" ng-disabled="isDisabledNextButton" class="btn btn-default btn-danger btn-block" target="_blank">NEXT</a><div ng-show="myCurrentRequestInResolving" class="number">No. {{myCurrentRequestInResolving._serverData.number}}</div><div class="panel" ng-show="line && !line._serverData.hidePanelMainScreen">Panel <input class="form-control" type="text" ng-model="panelName"></div></div></div><div class="main-screen container-fluid" ng-show="isMainScreenFullscreen" fullscreen="isMainScreenFullscreen"><md-toolbar md-scroll-shrink=""><div class="md-toolbar-tools"><h3><div ng-show="line._serverData.iconThumbnail._url" class="icon-div" style="background-image: url({{line._serverData.iconThumbnail._url}})"></div><span>{{line._serverData.title}}</span></h3></div></md-toolbar><table><tr class="header" ng-hide="line._serverData.hidePanelMainScreen"><td class="number-td">NUMBER</td><td class="panel-td">PANEL</td></tr><tr ng-repeat="request in screenPeople" ng-class="{ \'this-changed\': request.thisChanged }" class="body" ng-hide="request._serverData.resolvingFinishedAt"><td ng-class="{ \'panel-hidden\': line._serverData.hidePanelMainScreen }"><span class="number">{{request._serverData.number}}</span><span class="middle-dot">&middot;</span><span class="display-name">{{request._serverData.requestedByDisplayName}}</span></td><td ng-show="!line._serverData.hidePanelMainScreen && !request._serverData.panelName">-</td><td ng-show="!line._serverData.hidePanelMainScreen && request._serverData.panelName">{{request._serverData.panelName}}</td></tr></table></div><div class="main container-fluid" ng-show="!isMainScreenFullscreen" ng-class="{ fullscreen: isFullscreen }" fullscreen="isFullscreen"><div class="row"><div class="col-md-12" ng-show="line"><div class="resolver-top">Resolver&#58; <b>{{resolver._serverData.displayName}}</b> &lt;{{resolver._serverData.email}}&gt; <span class="glyphicon" ng-class="{ \'glyphicon-fullscreen\': !isFullscreen, \'glyphicon-resize-small\': isFullscreen }" ng-click="toggleFullScreen()" aria-hidden="true" ng-show="line && line._serverData.active"></span> <span class="glyphicon glyphicon glyphicon-list" ng-show="line && line._serverData.active && !isFullscreen" ng-click="toggleMainScreenFullscreen()" aria-hidden="true"></span></div><div class="next-request-container" ng-show="line && line._serverData.active"><a ng-click="toggleMainScreenFullscreen()" class="btn btn-default btn-primary" target="_blank">SCREEN</a> <a ng-click="NextRequest()" ng-disabled="isDisabledNextButton" class="btn btn-default btn-danger" target="_blank">NEXT</a></div><h2 class="line-name-top"><div ng-show="!!line._serverData.ACL.permissionsById[currentUser.id]"><span>ACTIVE</span><div class="btn-group" role="group" aria-label="..."><button type="button" class="btn btn-default" ng-click="setActiveLineStatus(true)" ng-class="{ \'btn-success\': line._serverData.active }">YES</button> <button type="button" class="btn btn-default" ng-click="setActiveLineStatus(false)" ng-class="{ \'btn-danger\': !line._serverData.active }">NO</button></div><span>COUNTER={{line._serverData.counter}}</span> <button ng-show="!line._serverData.active && !line._serverData.resetCounterOnActiveFalse && line._serverData.counter > 0" ng-click="resetCounter()" class="btn btn-danger">RESET</button></div>{{line._serverData.title}}</h2><div class="details">{{line._serverData.address}}</div><div class="details">{{line._serverData.hostname}}</div><div class="panel-name-top" ng-show="line && line._serverData.active"><span ng-show="!line._serverData.hidePanelMainScreen">Panel&#58; <input class="form-control" type="text" ng-model="panelName"></span> <button ng-show="!showFinished" ng-click="showFinished=true" class="btn btn-primary">SHOW FINISHED</button> <button ng-show="showFinished" ng-click="showFinished=false" class="btn btn-danger">HIDE FINISHED</button><button ng-show="true" ng-click="OpenClientsList($event)" class="btn btn-success">CLIENTS</button></div><div ng-show="line && !line._serverData.active"><h4>This waiting line is currently not active!</h4></div><div ng-show="line && line._serverData.active && (!people || people.length === 0)"><h4>This waiting line currently has not active requests!</h4></div><table ng-table="tableParams" class="table" ng-show="line && line._serverData.active && people.length > 0"><tr ng-repeat="request in people" ng-class="{ finished: request._serverData.resolvingFinishedAt, \'request-i-resolve\': request._serverData.resolver.id === currentUser.id, \'request-i-not-resolve\': request._serverData.resolver && request._serverData.resolver.id !== currentUser.id, \'is-finished\': request._serverData.resolvingFinishedAt }" ng-hide="!showFinished && request._serverData.resolvingFinishedAt"><td data-title="\'Number\'" width="30" class="number"><span>{{request._serverData.number}}</span></td><td data-title="\'Profile picture\'" ng-show="line._serverData.cameraRequestEnabled" width="70" class="icon"><div ng-show="request._serverData.requestedByProfilePicture._url" class="icon-div" ng-class="{ \'request-i-resolve\': (request._serverData.resolver.id === currentUser.id) && !request._serverData.resolvingFinishedAt }" style="background-image: url({{request._serverData.requestedByProfilePicture._url}})"></div><span ng-show="!request._serverData.requestedByProfilePicture._url">NO</span></td><td data-title="\'Anonymous\'" class="anonymous" width="70"><span ng-show="request._serverData.requestedByAnonymous">YES</span> <span ng-show="!request._serverData.requestedByAnonymous">NO</span></td><td data-title="\'Display name\'" class="display-name" width="150"><span ng-show="request._serverData.requestedByDisplayName">{{request._serverData.requestedByDisplayName}}</span> <span ng-show="!request._serverData.requestedByDisplayName">NONE</span></td><td data-title="\'Message\'" class="comment"><div class="truncate" ng-show="request._serverData.requestedByComment">{{request._serverData.requestedByComment}}</div><span ng-show="!request._serverData.requestedByComment">NO</span></td><td data-title="\'Got number\'" class="get-number">{{request.createdAt | date:\'dd.MM.yyyy. HH:mm:ss\'}}</td><td data-title="\'Came to location\'" class="get-number"><span ng-show="request._serverData.comeThereAt">{{request._serverData.comeThereAt | date:\'dd.MM.yyyy. HH:mm:ss\'}}</span> <span ng-show="!request._serverData.comeThereAt">NO</span></td><td data-title="\'Resolving started\'" class="resolving-started"><span ng-show="request._serverData.resolvingStartedAt">{{request._serverData.resolvingStartedAt | date:\'dd.MM.yyyy. HH:mm:ss\'}}</span> <span ng-show="!request._serverData.resolvingStartedAt">NO</span></td><td data-title="\'Resolver\'" class="resolver"><span ng-show="request._serverData.resolver">{{request._serverData.resolver._serverData.displayName}}</span> <span ng-show="!request._serverData.resolver">NONE</span></td><td data-title="\'Panel name\'" class="panel-name" ng-show="!line._serverData.hidePanelMainScreen"><span ng-show="request._serverData.panelName">{{request._serverData.panelName}}</span> <span ng-show="!request._serverData.panelName">-</span></td><td data-title="\'Resolving finished\'" class="resolving-finished"><span ng-show="request._serverData.resolvingFinishedAt">{{request._serverData.resolvingFinishedAt | date:\'dd.MM.yyyy. HH:mm:ss\'}}</span> <span ng-show="!request._serverData.resolvingFinishedAt">NO</span></td><td data-title="\'Resolving actions\'" class="actions"><a ng-show="!request._serverData.resolver && !isThereMyRequest" ng-click="StartResolving(request)" class="btn btn-default btn-success" target="_blank">START</a> <a ng-show="!request._serverData.resolver && isThereMyRequest" data-toggle="tooltip" data-placement="top" data-title="First FINISH your opened request." bs-tooltip="" class="btn btn-default btn-success is-there-my-request" target="_blank">START</a> <a ng-show="!request._serverData.resolvingFinishedAt && request._serverData.resolver.id === resolver.id" ng-click="FinishResolving(request)" class="btn btn-default btn-danger" target="_blank">FINISH</a> <a ng-show="!request._serverData.resolvingFinishedAt && request._serverData.resolver && !(request._serverData.resolver.id === resolver.id)" data-toggle="tooltip" data-placement="top" data-title="Only resolver can finish request." bs-tooltip="" class="btn btn-default btn-danger not-request-resolver" target="_blank">FINISH</a> <a ng-show="request._serverData.resolvingFinishedAt" ng-click="ArchiveRequest(request)" class="btn btn-default btn-primary" target="_blank">ARCHIVE</a></td></tr></table></div></div></div><div ng-controller="FooterCtrl" class="footer"><div ng-include="\'app/components/footer/footer.html\'"></div></div></md-content>'),e.put("app/components/errorPage/errorPage.html",'<md-content class="error-page"><div ng-controller="NavbarCtrl"><div ng-include="\'app/components/navbar/navbar.html\'"></div></div><div class="main container-fluid"><div class="row"><div class="col-md-12"><div class="error-container"><div class="code">{{error.code}}</div><div class="description">{{error.description}}</div></div></div></div></div><div ng-controller="FooterCtrl"><div ng-include="\'app/components/footer/footer.html\'"></div></div></md-content>'),e.put("app/components/footer/footer.html",'<footer><md-toolbar layout="row" layout-align="center center"><p>Copyright &copy; {{copyRightYear}} by Save<b>Time</b></p></md-toolbar></footer>'),e.put("app/components/navbar/navbar.html",'<md-toolbar layout="row" layout-align="center center" class="main-top-navbar" ng-controller="NavbarCtrl"><md-icon ng-click="GoToDashboard()" md-svg-src="/assets/images/icon.svg"></md-icon><div class="title md-headline" ng-click="GoToDashboard()" ng-class="{ \'not-visible\': currentUser._serverData.isResolver }">Save<b>Time</b></div><section flex="" layout="row" layout-align="left center" class="mobile-menu"><md-button ng-show="IsSignedIn && (currentUser._serverData.isResolver || currentUser._serverData.isWaitingLineOwner)" ng-click="GoToResolveLines()" class="md-raised resolve-lines-btn" ng-class="{ \'is-visible\': currentUser._serverData.isResolver }">Resolve</md-button></section><section flex="" layout="row" layout-align="left center" class="desktop-menu"><md-button ng-show="IsSignedIn && currentUser._serverData.isWaitingLineOwner" class="md-raised create-line-btn" ng-click="GoToNewWaitingLine()"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Create <span class="new-waiting">new waiting</span> <span class="line">line</span></md-button><md-button ng-show="IsSignedIn && currentUser._serverData.isWaitingLineOwner" ng-click="GoToMyWaitingLines()" class="md-raised my-lines-btn"><span class="glyphicon glyphicon-th-list" aria-hidden="true"></span> My <span class="waiting">waiting</span> lines</md-button><md-button ng-show="IsSignedIn && (currentUser._serverData.isResolver || currentUser._serverData.isWaitingLineOwner)" ng-click="GoToResolveLines()" class="md-raised resolve-lines-btn"><span class="glyphicon glyphicon-user" aria-hidden="true"></span> Resolve <span class="lines">lines</span></md-button></section><div class="title title-right md-headline" ng-show="IsSignedIn"><b>Make money</b> and never wait <b>in line</b> again!</div><div ng-controller="LogoutCtrl" ng-show="IsSignedIn" class="logout-container"><md-button ng-click="Logout()" class="md-raised"><span class="glyphicon glyphicon-off" aria-hidden="true"></span> <span class="text-span">Logout</span></md-button></div><div ng-controller="ProfileCtrl" ng-show="IsSignedIn" class="profile-container"><md-button class="md-raised" aria-label="Profile" ng-click="EditProfile($event)"><span class="glyphicon glyphicon-user" aria-hidden="true"></span> <span class="text-span">Profile</span></md-button></div><div layout="row" ng-show="!IsSignedIn && showBackButton" class="landing-return"><md-button ng-click="GoToLanding()" class="md-raised"><span class="long">&nbsp; GO TO LANDING PAGE &nbsp;</span> <span class="short">LANDING</span></md-button></div></md-toolbar>'),e.put("app/components/navbar/profileDialog.tmpl.html",'<md-dialog aria-label="Resolvers" class="profile-dialog"><form><md-toolbar><div class="md-toolbar-tools"><img ng-src="{{user.attributes.profilePictureThumbnail._url}}"><h2>Profile</h2><span flex=""></span><md-button class="md-icon-button" ng-click="answer(\'close\')"><md-icon md-svg-src="assets/images/ic_close_24px.svg" aria-label="Close dialog"></md-icon></md-button></div></md-toolbar><md-dialog-content><div class="display-name-container row"><div class="col-sm-6 col-md-4"><label>Email&#58;</label></div><div class="col-sm-6 col-md-8"><input type="text" class="form-control" ng-disabled="true" ng-value="user.attributes.email" placeholder="Email"></div></div><div class="display-name-container row" ng-show="!user.attributes.beAnonymousKeepPrivate"><div class="col-sm-6 col-md-4"><label>Display&nbsp;name&#58;</label></div><div class="col-sm-6 col-md-8"><input type="text" class="form-control" ng-enter="answer(\'update\')" ng-model="user.attributes.displayName" placeholder="Display name"></div></div><div class="profile-picture" ng-show="!user.attributes.beAnonymousKeepPrivate"><div class="row"><div class="col-sm-6 col-md-4"><label>Profile&nbsp;picture&#58;</label></div><div class="col-sm-6 col-md-8"><span class="btn btn-block btn-file needsclick" ng-class="{ \'btn-danger\': !profilePicture.base64, \'btn-success\': profilePicture.base64 }"><span ng-show="user.attributes.profilePictureThumbnail || profilePicture.base64">Change profile picture</span> <span ng-show="!user._serverData.profilePictureThumbnail && !profilePicture.base64">Choose profile picture</span> <input type="file" fileread="profilePicture.file" class="needsclick" accept="image/*" onclick="this.value = null" onchange="angular.element(this).scope().browseProfilePicture(this.files)"></span></div></div><div class="row"><div class="col-sm-12"><label ng-show="DEVICE.os === \'ios\' && !profilePicture.base64" class="control-label">NOTE&#58; from iPhone and iPad upload only image in landscape orientation because of orientation problem with portrait images.</label></div></div></div><div class="profile-picture-container" ng-show="!user.attributes.beAnonymousKeepPrivate"><div ng-show="profilePicture.base64" class="icon-div" style="background-image: url({{profilePicture.base64}})"></div><div ng-show="!profilePicture.base64 && user.attributes.profilePictureThumbnail._url" class="icon-div" style="background-image: url({{user.attributes.profilePictureThumbnail._url}})"></div><img src="/assets/images/no.png" ng-show="profilePicture.base64" class="remove needsclick" alt="X" ng-click="resetProfilePicture()"></div><div class="anonymous-container row"><div class="col-sm-6 col-md-4"><label>Keep&nbsp;privacy&#58;</label></div><div class="col-sm-6 col-md-8"><label><input type="checkbox" ng-model="user.attributes.beAnonymousKeepPrivate"></label></div><p class="help-block">NOTE&#58; hide display name and profile picture at online public waiting lines.</p></div></md-dialog-content><div class="md-actions" layout="row"><md-button ng-click="answer(\'cancel\')" class="md-primary">Cancel</md-button><md-button ng-click="answer(\'update\')" class="md-primary">Save</md-button></div></form></md-dialog>')
}]);